<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><title>深入解析 ES6：使用 Babel 和 Broccoli | bubkoo</title><meta name="author" content="bubkoo"><meta name="description" content="ES6 才刚被标准化，人们就在开始谈论 ES7 将提供哪些闪亮的新特性了。作为 Web 开发人员，我们更想知道如何使用这些新特性。在之前的文章中，作者鼓励我们在一些工具的帮助下开始使用 ES6：

如果你想使用这些新语法，你可以使用 Babel 或 Google 的 Traceur 将 ES6 代码转换为友好的 ES5 代码。

本文的主题就是这些工具的使用，上面这些工具被统称为 transpiler，transpiler 也被称为源码到源码的编译器，用于在抽象级别进行编程语言之间的相互转换。使用 transpiler 可以让我们用 ES6 语法来编写代码，同时保证这些代码能在所有浏览器上运行。"><meta name="viewport" content="width=device-width,initial-scale=1"><meta property="og:title" content="深入解析 ES6：使用 Babel 和 Broccoli"><meta property="og:site_name" content="bubkoo"><link href="/favicon.ico" rel="icon" type="image/x-ico"><link href="/atom.xml" rel="alternate" title="bubkoo" type="application/atom+xml"><link href="/css/style.css" rel="stylesheet" type="text/css" charset="utf-8"><link href="/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" charset="utf-8"><script id="google_analytics">(function (window, document, src, ga) {

  window['GoogleAnalyticsObject'] = ga;

  if (!window[ga]) {
    window[ga] = function () {
      (window[ga].q = window[ga].q || []).push(arguments);
    };
  }

  window[ga].l = 1 * new Date();

  var thisTag = document.getElementById('google_analytics');
  var script  = document.createElement('script');

  script.async = true;
  script.src   = src;

  thisTag.parentNode.insertBefore(script, thisTag);

  setTimeout(function () {
    script.parentNode.removeChild(script);
    thisTag.parentNode.removeChild(thisTag);
  }, 100);

})(window, document, 'https://www.google-analytics.com/analytics.js', 'ga');

ga('create', 'UA-78428859-2', 'auto');
ga('send', 'pageview');</script><script id="baidu_tongji">var _hmt = _hmt || [];
(function () {
  var script  = document.createElement('script');
  var thisTag = document.getElementById('baidu_tongji');

  script.src = '//hm.baidu.com/hm.js?49a1665c33b011585a2a629fdbed5b61';

  thisTag.parentNode.insertBefore(script, thisTag);

  setTimeout(function () {
    script.parentNode.removeChild(script);
    thisTag.parentNode.removeChild(thisTag);
  }, 100);
})();</script><!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]--><script>__start__ = window.performance && performance.timing ? performance.timing.navigationStart : Date.now();</script></head><body><header id="header" hoot="default" hoot-rate="1" class="inner"><div class="f-left"><a href="/" class="site-title">bubkoo</a></div><nav class="f-right"><ul class="site-nav"><li><a href="/">&lt;&gt;</a></li><li><a href="/archives">Archives</a></li><li><a href="https://github.com/bubkoo">Github</a></li></ul></nav></header><div id="container" class="inner"><div id="main"><article class="article post"><div class="article-wrap"><header class="article-header"><span class="article-header-icon icon-black"></span><h1 class="article-header-title">深入解析 ES6：使用 Babel 和 Broccoli</h1><time datetime="2015-08-15T13:12:38.000Z" itemprop="datePublished" class="article-header-time"><span class="day">15</span><span class="month">2015年08月</span></time></header><section class="article-content"><p>ES6 才刚被标准化，人们就在开始谈论 ES7 将提供哪些闪亮的新特性了。作为 Web 开发人员，我们更想知道如何使用这些新特性。在之前的文章中，作者鼓励我们在一些工具的帮助下开始使用 ES6：</p>
<blockquote>
<p>如果你想使用这些新语法，你可以使用 <a href="https://babeljs.io/" target="_blank" rel="external">Babel</a> 或 Google 的 <a href="https://github.com/google/traceur-compiler" target="_blank" rel="external">Traceur</a> 将 ES6 代码转换为友好的 ES5 代码。</p>
</blockquote>
<p>本文的主题就是这些工具的使用，上面这些工具被统称为 <em>transpiler</em>，transpiler 也被称为<a href="https://en.wikipedia.org/wiki/Source-to-source_compiler" target="_blank" rel="external">源码到源码的编译器</a>，用于在抽象级别进行编程语言之间的相互转换。使用 transpiler 可以让我们用 ES6 语法来编写代码，同时保证这些代码能在所有浏览器上运行。</p>
<a id="more"></a>
<h2><span id="transpiler">Transpiler</span></h2><p>使用 transpiler 非常简单，只需要下面两步：</p>
<p>1.用 ES6 语法编写代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> q = <span class="number">99</span>;</div><div class="line"><span class="keyword">let</span> myVariable = <span class="string">`<span class="subst">$&#123;q&#125;</span> bottles of beer on the wall, <span class="subst">$&#123;q&#125;</span> bottles of beer.`</span>;</div></pre></td></tr></table></figure>
<p>2.将上面代码作为 transpiler 的输入，经 transpiler 处理后将得到下面的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> q = <span class="number">99</span>;</div><div class="line"><span class="keyword">var</span> myVariable = <span class="string">""</span> + q + <span class="string">" bottles of beer on the wall, "</span> + q + <span class="string">" bottles of beer."</span></div></pre></td></tr></table></figure>
<p>得到的代码是老式的 JavaScript 语法，可以在任何浏览器中运行。</p>
<p>transpiler 的内部工作原理相当复杂，超出了本文的讨论范围。这里我们仅仅将 transpiler 作为一个黑盒来处理我们的代码，正如你会开车，但并不需要知道发动机的工作原理一样。</p>
<h2><span id="babel-实践">Babel 实践</span></h2><p>使用 Babel 有几种不同的方式。Babel 提供了一个命令行工具，你可以在终端中使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">babel script.js --out-file script-compiled.js</div></pre></td></tr></table></figure>
<p>还有一个浏览器端库。首先，将 Babel 嵌入到页面中，然后将你的 ES6 代码放在 <code>type</code> 属性值为 <code>text/babel</code> 的 <code>script</code> 标签中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/babel-core/browser.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="javascript"><span class="comment">// Your ES6 code</span></span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上面两种方式实用性不强，当代码变得庞大，我们就会开始将代码分割到不同文件或文件夹中。这时，我们就需要一个构建工具，并将 Babel 集成到我们的构建流程中。</p>
<p>下面我们将把 Babel 集成到一个构建工具中 – <a href="http://broccolijs.com/" target="_blank" rel="external">Broccoli.js</a>，并通过几个例子来演示 ES6 代码的编写和执行。示例的完整代码放在<a href="https://github.com/givanse/broccoli-babel-examples" target="_blank" rel="external">这里</a>，一共包含三个示例：</p>
<ul>
<li>es6-fruits</li>
<li>es6-website</li>
<li>es6-modules</li>
</ul>
<p>每个例子都是建立在前个例子的基础上，我们可以先从最简单的例子入手，然后进阶到一个通用的解决方案，最终可以作为一个庞大项目的起点。本文将详细讨论前面两个例子，之后你将能自行阅读和理解第三个例子中的代码。</p>
<p>如果你还在犹豫，那就等到浏览器兼容这些新特性吧，这样你也会被甩在时代的后面。浏览器完全兼容这些新特性需要很长的时间，而且每年都将发布一些新的 ECMAScript 标准，我们将看到新标准将比浏览器厂商的发布更加频繁。所以，别犹豫了，让我们开始使用这些新特性吧。</p>
<h2><span id="小试牛刀">小试牛刀</span></h2><p>Broccoli 是一个快速构建工具，不仅可以用来混淆和压缩文件，借助 <a href="https://www.npmjs.com/browse/keyword/broccoli-plugin" target="_blank" rel="external">Broccoli 插件</a>还可以做很多构建相关的工作，为我们节省了在处理文件、目录和执行命令上的时间。</p>
<h3><span id="准备工作">准备工作</span></h3><p>首先，我们需要<a href="https://nodejs.org/" target="_blank" rel="external">安装 Node 0.11 </a>或更新的版本。</p>
<p>如果你使用的是 unix 系统，那么请避免使用 package manager (apt, yum) 来安装，这可以避免在安装过程中使用 root 权限。最好只为当前用户使用链接中提供的二进制文件安装。在 <a href="http://givan.se/do-not-sudo-npm/" target="_blank" rel="external">这篇文章</a>中介绍了为什么不推荐使用 root 权限，同时文章中还提供了一些<a href="http://givan.se/do-not-sudo-npm/#install-npm-properly" target="_blank" rel="external">其他安装方式</a>。</p>
<h3><span id="项目初始化">项目初始化</span></h3><p>使用下面命令初始化我们的项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir es6-fruits</div><div class="line"><span class="built_in">cd</span> es6-fruits</div><div class="line">npm init</div><div class="line"><span class="comment"># Create an empty file called Brocfile.js</span></div><div class="line">touch Brocfile.js</div></pre></td></tr></table></figure>
<p>安装  <strong>broccoli</strong> 和 <strong>broccoli-cli</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># the broccoli library</span></div><div class="line">npm install --save-dev broccoli</div><div class="line"><span class="comment"># command line tool</span></div><div class="line">npm install -g broccoli-cli</div></pre></td></tr></table></figure>
<h3><span id="编写-es6-代码">编写 ES6 代码</span></h3><p>创建一个 <code>src</code> 目录，在目录中创建一个 <code>fruits.js</code> 文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir src</div><div class="line">vim src/fruits.js</div></pre></td></tr></table></figure>
<p>在我们创建的文件中，使用 ES6 语法编写一小段代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> fruits = [</div><div class="line">  &#123;<span class="attr">id</span>: <span class="number">100</span>, <span class="attr">name</span>: <span class="string">'strawberry'</span>&#125;,</div><div class="line">  &#123;<span class="attr">id</span>: <span class="number">101</span>, <span class="attr">name</span>: <span class="string">'grapefruit'</span>&#125;,</div><div class="line">  &#123;<span class="attr">id</span>: <span class="number">102</span>, <span class="attr">name</span>: <span class="string">'plum'</span>&#125;</div><div class="line">];</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> fruit <span class="keyword">of</span> fruits) &#123;</div><div class="line">  <span class="keyword">let</span> message = <span class="string">`ID: <span class="subst">$&#123;fruit.id&#125;</span> Name: <span class="subst">$&#123;fruit.name&#125;</span>`</span>;</div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(message);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">`List total: <span class="subst">$&#123;fruits.length&#125;</span>`</span>);</div></pre></td></tr></table></figure>
<p>上面代码中使用了 ES6 的三个新特性：</p>
<ol>
<li>用 <code>let</code> 声明局部变量</li>
<li><a href="https://hacks.mozilla.org/2015/04/es6-in-depth-iterators-and-the-for-of-loop/" target="_blank" rel="external">for-of</a> 循环</li>
<li><a href="https://hacks.mozilla.org/2015/05/es6-in-depth-template-strings-2/" target="_blank" rel="external">template strings</a></li>
</ol>
<p>保存文件，然后尝试执行一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node src/fruits.js</div></pre></td></tr></table></figure>
<p>我们看到执行报错了，但我们的目标是使这段代码可以在 Node 和任何浏览器上都能被执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">let</span> fruits = [</div><div class="line">    &lt;sup&gt;&lt;/sup&gt;&lt;sup&gt;&lt;/sup&gt;&lt;sup&gt;&lt;/sup&gt;</div><div class="line">SyntaxError: Unexpected identifier</div></pre></td></tr></table></figure>
<h3><span id="transpilation">Transpilation</span></h3><p>接下来我们将使用 Broccoli 来加载代码，并通过 Babel 处理，修改 <code>Brocfile.js</code> 文件如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// import the babel plugin</span></div><div class="line"><span class="keyword">var</span> babel = <span class="built_in">require</span>(<span class="string">'broccoli-babel-transpiler'</span>);</div><div class="line"></div><div class="line"><span class="comment">// grab the source and transpile it in 1 step</span></div><div class="line">fruits = babel(<span class="string">'src'</span>); <span class="comment">// src/*.js</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = fruits;</div></pre></td></tr></table></figure>
<p><code>broccoli-babel-transpiler</code> 这个包是 Broccoli 的一个插件，使用前需要安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev broccoli-babel-transpiler</div></pre></td></tr></table></figure>
<p>构建并执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">broccoli build dist <span class="comment"># compile</span></div><div class="line">node dist/fruits.js <span class="comment"># execute ES5</span></div></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ID: 100 Name: strawberry</div><div class="line">ID: 101 Name: grapefruit</div><div class="line">ID: 102 Name: plum</div><div class="line">List total: 3</div></pre></td></tr></table></figure>
<p>有木有很简单啊！打开 <code>dist/fruits.js</code> 文件来看看编译后的代码，我们将发现通过 Babel 生成的代码可读性是非常强的。</p>
<h2><span id="在-web-开发中的使用">在 Web 开发中的使用</span></h2><p>接下来我们来看一个稍复杂的例子。首先，退出 <code>es6-fruits</code> 目录；然后，按照之前的步骤创建 <code>es6-website</code> 目录。</p>
<p>在 <code>src</code> 目录下创建下面三个文件：</p>
<p><code>src/index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ES6 Today<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="undefined">    body &#123;</span></div><div class="line"><span class="css">      <span class="selector-tag">border</span>: 2<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#9a9a9a</span>;</span></div><div class="line"><span class="undefined">      border-radius: 10px;</span></div><div class="line"><span class="undefined">      padding: 6px;</span></div><div class="line"><span class="undefined">      font-family: monospace;</span></div><div class="line"><span class="undefined">      text-align: center;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="css">    <span class="selector-class">.color</span> &#123;</span></div><div class="line"><span class="undefined">      padding: 1rem;</span></div><div class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></div><div class="line"><span class="undefined">    &#125;</span></div><div class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ES6 Today<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"info"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//code.jquery.com/jquery-2.1.4.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/my-app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>src/print-info.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printInfo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  $(<span class="string">'#info'</span>)</div><div class="line">      .append(<span class="string">'&lt;p&gt;minimal website example with'</span> +</div><div class="line">              <span class="string">'Broccoli and Babel&lt;/p&gt;'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">$(printInfo);</div></pre></td></tr></table></figure>
<p><code>src/print-colors.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ES6 Generator</span></div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">hexRange</span>(<span class="params">start, stop, step</span>) </span>&#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = start; i &lt; stop; i += step) &#123;</div><div class="line">    <span class="keyword">yield</span> i;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printColors</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> content$ = $(<span class="string">'#content'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// contrived example</span></div><div class="line">  <span class="keyword">for</span> ( <span class="keyword">var</span> hex <span class="keyword">of</span> hexRange(<span class="number">900</span>, <span class="number">999</span>, <span class="number">10</span>) ) &#123;</div><div class="line">    <span class="keyword">var</span> newDiv = $(<span class="string">'&lt;div&gt;'</span>)</div><div class="line">      .attr(<span class="string">'class'</span>, <span class="string">'color'</span>)</div><div class="line">      .css(&#123; <span class="string">'background-color'</span>: <span class="string">`#<span class="subst">$&#123;hex&#125;</span>`</span> &#125;)</div><div class="line">      .append(<span class="string">`hex code: #<span class="subst">$&#123;hex&#125;</span>`</span>);</div><div class="line">    content$.append(newDiv);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$(printColors);</div></pre></td></tr></table></figure>
<p>或许你已经注意到 <code>function* hexRange</code>，没错这就是 <a href="https://hacks.mozilla.org/2015/05/es6-in-depth-generators/" target="_blank" rel="external">ES6 generator</a>，目前该特性还没有被所有浏览器兼容，为了使用这个特性，我们需要一个 polyfill，Babel 为我们提供了这个 polyfill。</p>
<p>下一步就是合并 JS 文件，难点在于 <code>Brocfile.js</code> 文件的编写，这次我们需要安装 4 个插件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev broccoli-babel-transpiler</div><div class="line">npm install --save-dev broccoli-funnel</div><div class="line">npm install --save-dev broccoli-concat</div><div class="line">npm install --save-dev broccoli-merge-trees</div></pre></td></tr></table></figure>
<p><code>Brocfile.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Babel transpiler</span></div><div class="line"><span class="keyword">var</span> babel = <span class="built_in">require</span>(<span class="string">'broccoli-babel-transpiler'</span>);</div><div class="line"><span class="comment">// filter trees (subsets of files)</span></div><div class="line"><span class="keyword">var</span> funnel = <span class="built_in">require</span>(<span class="string">'broccoli-funnel'</span>);</div><div class="line"><span class="comment">// concatenate trees</span></div><div class="line"><span class="keyword">var</span> concat = <span class="built_in">require</span>(<span class="string">'broccoli-concat'</span>);</div><div class="line"><span class="comment">// merge trees</span></div><div class="line"><span class="keyword">var</span> mergeTrees = <span class="built_in">require</span>(<span class="string">'broccoli-merge-trees'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Transpile the source files</span></div><div class="line"><span class="keyword">var</span> appJs = babel(<span class="string">'src'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Grab the polyfill file provided by the Babel library</span></div><div class="line"><span class="keyword">var</span> babelPath = <span class="built_in">require</span>.resolve(<span class="string">'broccoli-babel-transpiler'</span>);</div><div class="line">babelPath = babelPath.replace(<span class="regexp">/\/index.js$/</span>, <span class="string">''</span>);</div><div class="line">babelPath += <span class="string">'/node_modules/babel-core'</span>;</div><div class="line"><span class="keyword">var</span> browserPolyfill = funnel(babelPath, &#123;</div><div class="line">  files: [<span class="string">'browser-polyfill.js'</span>]</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Add the Babel polyfill to the tree of transpiled files</span></div><div class="line">appJs = mergeTrees([browserPolyfill, appJs]);</div><div class="line"></div><div class="line"><span class="comment">// Concatenate all the JS files into a single file</span></div><div class="line">appJs = concat(appJs, &#123;</div><div class="line">  <span class="comment">// we specify a concatenation order</span></div><div class="line">  inputFiles: [<span class="string">'browser-polyfill.js'</span>, <span class="string">'**/*.js'</span>],</div><div class="line">  outputFile: <span class="string">'/js/my-app.js'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Grab the index file</span></div><div class="line"><span class="keyword">var</span> index = funnel(<span class="string">'src'</span>, &#123;<span class="attr">files</span>: [<span class="string">'index.html'</span>]&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Grab all our trees and</span></div><div class="line"><span class="comment">// export them as a single and final tree</span></div><div class="line"><span class="built_in">module</span>.exports = mergeTrees([index, appJs]);</div></pre></td></tr></table></figure>
<p>构建：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">broccoli build dist</div></pre></td></tr></table></figure>
<p>构建结果，<code>dist</code> 的目录结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$&gt; tree dist/</div><div class="line">dist/</div><div class="line">├── index.html</div><div class="line">└── js</div><div class="line">    └── my-app.js</div></pre></td></tr></table></figure>
<p>这就是一个完整静态网站的根目录，可以使用任何静态服务器来启动，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> dist/</div><div class="line">python -m SimpleHTTPServer</div><div class="line"><span class="comment"># visit http://localhost:8000/</span></div></pre></td></tr></table></figure>
<p>你将看到如下结果：</p>
<p><img src="http://bubkoo.qiniudn.com/images/es6-in-depth-babel-and-broccoli.png" alt=""></p>
<p class="j-quote">参考原文：<a href="https://hacks.mozilla.org/2015/06/es6-in-depth-babel-and-broccoli/" target="_blank" rel="external">ES6 In Depth: Using ES6 today with Babel and Broccoli</a><br>原文作者：<a href="https://hacks.mozilla.org/author/jorendorffmozillacom/" target="_blank" rel="external">Jason Orendorff</a><br>原文日期：2015-06-17 21:38</p></section><footer class="article-footer clearfix"><div class="categories"><a href="/categories/javascript/" title="JavaScript">JavaScript</a></div><div class="tags"><a href="/tags/es6/" title="ES6">ES6</a></div></footer></div><nav class="article-nav clearfix"><a href="/2015/10/09/es6-in-depth-collections/" class="article-nav-link article-nav-newer"><strong class="article-nav-type">Newer</strong><span class="article-nav-title">深入解析 ES6：Collections</span></a><a href="/2015/07/24/es6-in-depth-symbols/" class="article-nav-link article-nav-older"><strong class="article-nav-type">Older</strong><span class="article-nav-title">深入解析 ES6：Symbol</span></a></nav></article><section id="article-comment" class="article-comment"></section><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><style>.gitment-root-container{
  margin: 40px 0;
}
.gitment-container {
  font-size: 12px;
}
.gitment-comment-main, .gitment-editor-main{
  background-color: #fff;
}
.gitment-footer-container{
  color: #999;
}
.gitment-comment-main,
.gitment-editor-main{
  background: #fff;
}
a.gitment-footer-project-link,
a.gitment-footer-project-link:visited,
a.gitment-editor-login-link,
a.gitment-editor-login-link:visited {
  color: #1ba1e2;
  opacity: .3;
  -webkit-transition: opacity 0.4s;
  -moz-transition: opacity 0.4s;
  -o-transition: opacity 0.4s;
  -ms-transition: opacity 0.4s;
  transition: opacity 0.4s;
}
a.gitment-footer-project-link:hover,
a.gitment-editor-login-link:hover{
  opacity: 1;
  -webkit-transition: opacity 0.4s;
  -moz-transition: opacity 0.4s;
  -o-transition: opacity 0.4s;
  -ms-transition: opacity 0.4s;
  transition: opacity 0.4s;
}</style><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var options = {
  owner: 'bubkoo',
  repo:  'bubkoo.github.com',
  oauth: {
    client_id: '13c9fa4a27f96e5296bf',
    client_secret: 'd0f07fcf8605a22de1e57fd96ddb0666d2ce0751',
  }
};
var gitment = new Gitment(options);
gitment.render('article-comment')</script></div><aside id="sidebar" role="sidebar"><div class="widget tagcloud"><h3 class="widget-title">标签</h3><div class="widget-content"><a href="/tags/aop/" style="font-size: 10px">AOP</a> <a href="/tags/algorithm/" style="font-size: 18.33px">Algorithm</a> <a href="/tags/analysis/" style="font-size: 10px">Analysis</a> <a href="/tags/angularjs/" style="font-size: 15px">AngularJS</a> <a href="/tags/animation/" style="font-size: 10px">Animation</a> <a href="/tags/architecture/" style="font-size: 16.67px">Architecture</a> <a href="/tags/archives/" style="font-size: 10.83px">Archives</a> <a href="/tags/async/" style="font-size: 12.5px">Async</a> <a href="/tags/backbone/" style="font-size: 10px">Backbone</a> <a href="/tags/browsers/" style="font-size: 10px">Browsers</a> <a href="/tags/css/" style="font-size: 12.5px">CSS</a> <a href="/tags/css3/" style="font-size: 10px">CSS3</a> <a href="/tags/closure/" style="font-size: 10.83px">Closure</a> <a href="/tags/closures/" style="font-size: 10px">Closures</a> <a href="/tags/cookies/" style="font-size: 10px">Cookies</a> <a href="/tags/cross-domain/" style="font-size: 10px">Cross Domain</a> <a href="/tags/custom-elements/" style="font-size: 10.83px">Custom Elements</a> <a href="/tags/d3/" style="font-size: 10px">D3</a> <a href="/tags/debounce/" style="font-size: 10px">Debounce</a> <a href="/tags/debug/" style="font-size: 10.83px">Debug</a> <a href="/tags/dependency/" style="font-size: 10px">Dependency</a> <a href="/tags/document/" style="font-size: 10px">Document</a> <a href="/tags/ecma-262-3/" style="font-size: 15.83px">ECMA-262-3</a> <a href="/tags/ecmascript/" style="font-size: 15.83px">ECMAScript</a> <a href="/tags/es6/" style="font-size: 20px">ES6</a> <a href="/tags/errors/" style="font-size: 10px">Errors</a> <a href="/tags/essential/" style="font-size: 10px">Essential</a> <a href="/tags/evaluation-strategy/" style="font-size: 10px">Evaluation strategy</a> <a href="/tags/event/" style="font-size: 10px">Event</a> <a href="/tags/exceptions/" style="font-size: 10px">Exceptions</a> <a href="/tags/express/" style="font-size: 10px">Express</a> <a href="/tags/flip/" style="font-size: 10px">FLIP</a> <a href="/tags/flexbox/" style="font-size: 10px">Flexbox</a> <a href="/tags/framework/" style="font-size: 10px">Framework</a> <a href="/tags/funarg/" style="font-size: 10px">Funarg</a> <a href="/tags/gist/" style="font-size: 10px">Gist</a> <a href="/tags/github/" style="font-size: 10px">Github</a> <a href="/tags/guide/" style="font-size: 10px">Guide</a> <a href="/tags/html/" style="font-size: 10px">HTML</a> <a href="/tags/http/" style="font-size: 10px">HTTP</a> <a href="/tags/hexo/" style="font-size: 10.83px">Hexo</a> <a href="/tags/ie/" style="font-size: 10px">IE</a> <a href="/tags/iife/" style="font-size: 10px">IIFE</a> <a href="/tags/jshint/" style="font-size: 10px">JSHint</a> <a href="/tags/javascript/" style="font-size: 19.17px">JavaScript</a> <a href="/tags/leak/" style="font-size: 10px">Leak</a> <a href="/tags/linting/" style="font-size: 10px">Linting</a> <a href="/tags/mvc/" style="font-size: 10px">MVC</a> <a href="/tags/methodology/" style="font-size: 10px">Methodology</a> <a href="/tags/mickey/" style="font-size: 10px">Mickey</a> <a href="/tags/mock/" style="font-size: 10px">Mock</a> <a href="/tags/modular/" style="font-size: 10px">Modular</a> <a href="/tags/mongodb/" style="font-size: 10px">MongoDB</a> <a href="/tags/oop/" style="font-size: 10.83px">OOP</a> <a href="/tags/partial-application/" style="font-size: 10px">Partial Application</a> <a href="/tags/pattern/" style="font-size: 10px">Pattern</a> <a href="/tags/patterns/" style="font-size: 10px">Patterns</a> <a href="/tags/performance/" style="font-size: 14.17px">Performance</a> <a href="/tags/promise/" style="font-size: 13.33px">Promise</a> <a href="/tags/prototype/" style="font-size: 11.67px">Prototype</a> <a href="/tags/quality/" style="font-size: 10px">Quality</a> <a href="/tags/quiz/" style="font-size: 10px">Quiz</a> <a href="/tags/react/" style="font-size: 10px">React</a> <a href="/tags/regex/" style="font-size: 10px">Regex</a> <a href="/tags/requirejs/" style="font-size: 10px">RequireJS</a> <a href="/tags/sass/" style="font-size: 10px">SASS</a> <a href="/tags/svg/" style="font-size: 10px">SVG</a> <a href="/tags/scope/" style="font-size: 10.83px">Scope</a> <a href="/tags/shapes/" style="font-size: 10px">Shapes</a> <a href="/tags/shuffle/" style="font-size: 10px">Shuffle</a> <a href="/tags/sort/" style="font-size: 17.5px">Sort</a> <a href="/tags/source-map/" style="font-size: 10.83px">Source Map</a> <a href="/tags/styling/" style="font-size: 10px">Styling</a> <a href="/tags/sublime-text/" style="font-size: 10px">Sublime Text</a> <a href="/tags/template/" style="font-size: 10px">Template</a> <a href="/tags/throttle/" style="font-size: 10px">Throttle</a> <a href="/tags/timing/" style="font-size: 10px">Timing</a> <a href="/tags/tools/" style="font-size: 12.5px">Tools</a> <a href="/tags/variable-object/" style="font-size: 10px">Variable object</a> <a href="/tags/visualizations/" style="font-size: 10px">Visualizations</a> <a href="/tags/when/" style="font-size: 12.5px">When</a> <a href="/tags/delete/" style="font-size: 10px">delete</a> <a href="/tags/execution-context/" style="font-size: 10px">execution context</a> <a href="/tags/fetch/" style="font-size: 10px">fetch</a> <a href="/tags/function/" style="font-size: 10px">function</a> <a href="/tags/nodejs/" style="font-size: 10px">nodejs</a> <a href="/tags/nodemon/" style="font-size: 10px">nodemon</a> <a href="/tags/npm/" style="font-size: 10px">npm</a> <a href="/tags/nvm/" style="font-size: 10px">nvm</a> <a href="/tags/performance/" style="font-size: 10px">performance</a> <a href="/tags/prebrowsing/" style="font-size: 10px">prebrowsing</a> <a href="/tags/prefetching/" style="font-size: 10px">prefetching</a> <a href="/tags/preloading/" style="font-size: 10px">preloading</a> <a href="/tags/tabindex/" style="font-size: 10px">tabindex</a> <a href="/tags/this/" style="font-size: 10px">this</a> <a href="/tags/ui-router/" style="font-size: 14.17px">ui-router</a></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-content"><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/21/react-framework-mickey/">React 框架新轮子：Mickey</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/18/debouncing-throttling-explained-examples/">实例解析防抖和节流函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/quick-tip-multiple-versions-node-nvm/">使用 nvm 管理不同版本的 node 与 npm</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/15-ways-to-write-self-documenting-javascript/">如何编写更加自解释的代码</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/31/high-performance-animations/">使用 FLIP 来提高 Web 动画的性能</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/28/styling-broken-images/">定制图片加载失败时的样式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/26/delivering-octicons-with-svg/">使用 SVG 输出 Octicon</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/18/how-to-use-npm-as-a-build-tool/">如何将 npm 作为构建工具使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/24/what-you-can-do-with-gists-on-github/">任何人都可以使用到的 Gist 服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/19/prefetching-preloading-prebrowsing/">前端性能优化 - 资源预加载</a></li></ul></div></div></aside><aside id="topic-wrap" class="toc-wrap f-right"><h3 class="toc-wrap-title">内容</h3><div class="toc-tree"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">Transpiler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">Babel 实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">小试牛刀</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.</span> <span class="toc-text">项目初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.3.</span> <span class="toc-text">编写 ES6 代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.4.</span> <span class="toc-text">Transpilation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">在 Web 开发中的使用</span></a></li></ol></div><div class="toc-progress"></div></aside></div><footer id="footer" class="inner"><span class="copyright">© 2017 bubkoo</span><span class="theme">@<a href="https://github.com/bubkoo/hexo-theme-formula" target="_blank">formula</a></span></footer><img id="go2top" src="/images/top_arrow.png" alt="go2top"><script charset="utf-8" src="/js/lib/jquery-2.1.3.min.js"></script><script charset="utf-8" src="/js/lib/jquery.imagesloaded.min.js"></script><script charset="utf-8" src="/fancybox/jquery.fancybox.pack.js"></script><script charset="utf-8" src="/js/lib/sea.js"></script><script charset="utf-8" src="/js/main.js"></script></body></html>