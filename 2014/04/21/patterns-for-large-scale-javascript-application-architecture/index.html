<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><title>大型 JavaScript 架构中的设计模式 | bubkoo</title><meta name="author" content="bubkoo"><meta name="description" content="我们今天要讨论的主题是，大型 JavaScript 应用中一些有效的设计模式。本文基于我最近发布在 LondonJS 上同名演讲，灵感则来自于 Nicholas Zakas 之前的研究成果。
我是谁以及我为什么要撰写这个主题？我目前是 AOL 的一名 JavaScript 和 UI 开发人员，负责规划和编写下一代面向用户的应用的前端架构。这些应用不仅复杂，而且需要一种可扩展和高复用的架构，我的职责之一就是确保这类应用中的设计模式尽可能是可持续的。
尽管在这个领域有许多比我知识渊博的专家，我也认为自己是设计模式的狂热者。先前，我基于 Creative Commons 许可写了 《Essential JavaScript Design Patterns》 一书，现在我正在为此书撰写更详尽的后续版本。
140 个字的全文概述如果你时间不够，下面是本文的概述，只有一条 tweet 的长度。
应用解耦。架构/模块，外观模式和中介模式。模块发布消息，中介管理发布/订阅，外观处理安全问题。

什么是“大型” JavaScript 应用正式开始之前，我们先尝试为“大型” JavaScript 应用下个定义。我发现，即便是在这个领域有多年开发经验的开发者，对于这个问题他们的答案都可能很主观。
作为实验，我询问了一些中级开发者，让他们试着作一个非正式的定义。一个开发者认为是代码超过 100,000 行的 JavaScript 应用，而另一个则认为是源代码超过 1M 的 JavaScript 应用。他们的答案很大胆，但都准确，因为代码量的大小不总是和应用的复杂度相关，100,000 行代码也可能是相当琐碎的代码。
虽然我的定义并不一定是普遍观点，但我认为这更接近大型 JavaScript 应用的本质：
在我看来，大型 JavaScript 应用是那种非琐碎，并且需要大量开发人员努力维护的应用，在浏览器端有繁重的数据操作和显示处理。

也许，该定义的最后一句话才是最重要的。"><meta name="viewport" content="width=device-width,initial-scale=1"><meta property="og:title" content="大型 JavaScript 架构中的设计模式"><meta property="og:site_name" content="bubkoo"><link href="/favicon.ico" rel="icon" type="image/x-ico"><link href="/atom.xml" rel="alternate" title="bubkoo" type="application/atom+xml"><link href="/css/style.css" rel="stylesheet" type="text/css" charset="utf-8"><link href="/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" charset="utf-8"><script id="google_analytics">(function (window, document, src, ga) {

  window['GoogleAnalyticsObject'] = ga;

  if (!window[ga]) {
    window[ga] = function () {
      (window[ga].q = window[ga].q || []).push(arguments);
    };
  }

  window[ga].l = 1 * new Date();

  var thisTag = document.getElementById('google_analytics');
  var script  = document.createElement('script');

  script.async = true;
  script.src   = src;

  thisTag.parentNode.insertBefore(script, thisTag);

  setTimeout(function () {
    script.parentNode.removeChild(script);
    thisTag.parentNode.removeChild(thisTag);
  }, 100);

})(window, document, 'https://www.google-analytics.com/analytics.js', 'ga');

ga('create', 'UA-78428859-2', 'auto');
ga('send', 'pageview');</script><script id="baidu_tongji">var _hmt = _hmt || [];
(function () {
  var script  = document.createElement('script');
  var thisTag = document.getElementById('baidu_tongji');

  script.src = '//hm.baidu.com/hm.js?49a1665c33b011585a2a629fdbed5b61';

  thisTag.parentNode.insertBefore(script, thisTag);

  setTimeout(function () {
    script.parentNode.removeChild(script);
    thisTag.parentNode.removeChild(thisTag);
  }, 100);
})();</script><!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]--><script>__start__ = window.performance && performance.timing ? performance.timing.navigationStart : Date.now();</script></head><body><header id="header" hoot="default" hoot-rate="1" class="inner"><div class="f-left"><a href="/" class="site-title">bubkoo</a></div><nav class="f-right"><ul class="site-nav"><li><a href="/">&lt;&gt;</a></li><li><a href="/archives">Archives</a></li><li><a href="https://github.com/bubkoo">Github</a></li></ul></nav></header><div id="container" class="inner"><div id="main"><article class="article post"><div class="article-wrap"><header class="article-header"><span class="article-header-icon icon-black"></span><h1 class="article-header-title">大型 JavaScript 架构中的设计模式</h1><time datetime="2014-04-21T22:57:24.000Z" itemprop="datePublished" class="article-header-time"><span class="day">21</span><span class="month">2014年04月</span></time></header><section class="article-content"><p>我们今天要讨论的主题是，大型 JavaScript 应用中一些有效的设计模式。本文基于我最近发布在 LondonJS 上同名演讲，灵感则来自于 Nicholas Zakas <a href="http://yuilibrary.com/theater/nicholas-zakas/zakas-architecture/" target="_blank" rel="external">之前的研究成果</a>。</p>
<h2 id="我是谁以及我为什么要撰写这个主题"><a href="#我是谁以及我为什么要撰写这个主题？" class="headerlink" title="我是谁以及我为什么要撰写这个主题？"></a>我是谁以及我为什么要撰写这个主题？</h2><p>我目前是 AOL 的一名 JavaScript 和 UI 开发人员，负责规划和编写下一代面向用户的应用的前端架构。这些应用不仅复杂，而且需要一种可扩展和高复用的架构，我的职责之一就是确保这类应用中的设计模式尽可能是可持续的。</p>
<p>尽管在这个领域有许多比我知识渊博的专家，我也认为自己是设计模式的狂热者。先前，我基于 <a href="http://wiki.creativecommons.org/Books" target="_blank" rel="external">Creative Commons</a> 许可写了 <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/" target="_blank" rel="external">《Essential JavaScript Design Patterns》</a> 一书，现在我正在为此书撰写更详尽的后续版本。</p>
<h2 id="140-个字的全文概述"><a href="#140-个字的全文概述" class="headerlink" title="140 个字的全文概述"></a>140 个字的全文概述</h2><p>如果你时间不够，下面是本文的概述，只有一条 tweet 的长度。</p>
<p class="j-warning">应用解耦。架构/模块，外观模式和中介模式。模块发布消息，中介管理发布/订阅，外观处理安全问题。</p>

<h2 id="什么是大型-javascript-应用"><a href="#什么是“大型”-JavaScript-应用" class="headerlink" title="什么是“大型” JavaScript 应用"></a>什么是“大型” JavaScript 应用</h2><p>正式开始之前，我们先尝试为“大型” JavaScript 应用下个定义。我发现，即便是在这个领域有多年开发经验的开发者，对于这个问题他们的答案都可能很主观。</p>
<p>作为实验，我询问了一些中级开发者，让他们试着作一个非正式的定义。一个开发者认为是代码超过 100,000 行的 JavaScript 应用，而另一个则认为是源代码超过 1M 的 JavaScript 应用。他们的答案很大胆，但都<strong>准确</strong>，因为代码量的大小不总是和应用的复杂度相关，100,000 行代码也可能是相当琐碎的代码。</p>
<p>虽然我的定义并不一定是普遍观点，但我认为这更接近大型 JavaScript 应用的本质：</p>
<p class="j-warning">在我看来，大型 JavaScript 应用是那种<strong>非琐碎</strong>，并且需要<strong>大量</strong>开发人员努力维护的应用，在浏览器端有繁重的数据操作和显示处理。</p>

<p>也许，该定义的最后一句话才是最重要的。</p>
<a id="more"></a>
<h2 id="回顾一下你目前的架构"><a href="#回顾一下你目前的架构" class="headerlink" title="回顾一下你目前的架构"></a>回顾一下你目前的架构</h2><p class="j-warning">如果准备开发一个大型 JavaScript 应用，请记得投入<strong>充足的时间</strong>来做基础架构，这才是最有意义的，而且通常比你最初的想象要复杂。</p>

<p>这里我不再啰嗦强调基础架构的重要性了，一些开发者在开发大型应用时，都认为：“我在之前中型项目中的开发中积累了一套完善的解决和设计模式，这也应该适用于稍大的项目。”在某种程度上这是可行的，但请不要想当然，<strong>更大的应用通常需要考虑更多的问题</strong>。我即将讨论为什么花费更多的时间来规划应用架构从长远来看是值得的。</p>
<p>对大多数 JavaScript 开发人员来说，在他们目前的架构中都或多或少使用了如下这些模块：</p>
<ul>
<li>自定义组件 (custom widgets)</li>
<li>模型 (models)</li>
<li>视图 (views)</li>
<li>控制器 (controllers)</li>
<li>模板 (templates)</li>
<li>库/工具集 (libraries/toolkits)</li>
<li>应用程序核心 (application core)</li>
</ul>
<p class="j-info"><strong>相关阅读</strong><br>- <a href="http://blog.rebeccamurphey.com/code-org-take-2-structuring-javascript-applic" target="_blank" rel="external">Rebecca Murphey - Structuring JavaScript Applications</a><br>- <a href="http://michaux.ca/articles/mvc-architecture-for-javascript-applications" target="_blank" rel="external">Peter Michaux - MVC Architecture For JavaScript Applications</a><br>- <a href="http://stackoverflow.com/questions/5112899/knockout-js-vs-backbone-js-vs" target="_blank" rel="external">StackOverflow - A discussion on modern MVC frameworks</a><br>- <a href="http://msdn.microsoft.com/en-us/scriptjunkie/ff706600" target="_blank" rel="external">Doug Neiner - Stateful Plugins and the Widget Factory</a><br></p>

<p>或许你还将你的应用划分为不同的功能模块，并应用了其他一些设计模式，这非常好，但可能还不够，获取还会遇到一系列潜在的问题。</p>
<p><strong>1. 哪些模块可以独立复用？</strong></p>
<p>单个模块可以独立存在吗？他们是自包含的吗？如果让我看看你或者你的团队正在编写的大型应用的代码，我会随机选择一个模块，并将其丢在一个新页面中，可以就这样简单地独立使用这个模块吗？为什么要这样做？从长远来看，如果你的公司开始开发越来越多的应用，应用之间又有某些交叉的功能，如果有人说：“我们的用户喜欢邮件客户端的聊天模块，让我们将其添加到我们新的协作编辑套件中吧”，可以通过复用模块来实现吗？</p>
<p><strong>2. 系统中有多少模块依赖于其他模块？</strong></p>
<p>模块间是紧耦合的吗？在深入讨论前，值得一提的是：在一个系统中一个模块完全不依赖其他模块，并不总是可行，在某个粒度级别，一些模块可以从其它一些基础模块扩展而来。而我们讨论的问题是不同功能模块之间的关联度，应该使这些不同的模块不依赖或加载过多的其它模块。</p>
<p><strong>3. 如果某模块崩溃了，应用仍然可用吗？</strong></p>
<p>如果你正在构建一个类似 GMail 的应用，当邮件模块崩溃时，不应该影响其它部位的使用，如聊天应用。同时，按照之前所说，一个模块应该能够脱离当前的应用而独立存在。在我的演讲中，我提到了基于用户意图的动态模块加载，例如，在上例中，用户可能默认关闭了聊天应用，页面初始化时就不需要加载相关的模块，当用户通过某些操作想要使用聊天应用时，才动态加载对应的模块，并且加载过来的模块不会对之前模块造成影响。</p>
<p><strong>4. 对独立模块的测试容易吗？</strong></p>
<p>对于一个大规模的系统，每天都有数以百万计的用户（或恶意用户）在使用系统的不同部位。有必要对那些可复用的模块进行充分的测试，保证模块在当前的架构和脱离当前架构时，测试都是可行的，这样才能为模块复用提供最大的保证。</p>
<h2 id="从长远考虑"><a href="#从长远考虑" class="headerlink" title="从长远考虑"></a>从长远考虑</h2><p>做基础架构时，从长远考虑很重要，尽可能预测系统将来会有什么样的改变，虽然不可能准确预估系统将如何增长，但肯定有可考虑的空间。到此，你会想到你的系统中的某些模块吗？</p>
<p>开发人员经常将 DOM 操作代码和其他代码紧紧地耦合在一起，他们即将面临将核心逻辑代码独立成模块的问题。如果稍微长远考虑一下，他们就不会这样做。</p>
<p>我的一个听众认为，这样严格的架构可能并不适用于未来。非常正确，然而，如果现在不考虑进来，将来可能会耗费更多的成本。</p>
<p class="j-warning">将来，可能由于性能、安全或设计问题，你决定把正在使用的 Dojo、jQuery、Zepto 或 YUI 换成一个完全不同的库。这很可能会演变成一个问题，因为不同库之间不容易互换，并且，如果当前库与你的应用紧密耦合的话，将导致高额的转换成本。</p>

<p>假如你是一个 Dojo 的使用者，或许现在没有更好的库可以切换过去，但谁能保证未来几年不会出现更好的库呢，而且那时你又想切换过去呢？</p>
<p>如果你的架构足够灵活，并不关心模块使用的是神马底层库，将大大节约时间和经济成本。</p>
<p>总而言之，如果你的应用还做不到不重写整个应用而完成底层库的切换，请继续阅读。</p>
<p>下面引用了一些有影响力的 JavaScript 开发者的观点：</p>
<p class="j-warning">“构建大型应用的秘诀在于永远不要构建大型应用，将你的应用分解成小块，然后将这些可测试的、颗粒化的小块组装成你的大型应用” - <strong>Justin Meyer, author JavaScriptMVC</strong></p>

<p class="j-warning">“关键是一开始就必须承认你不可能完全预测到你的应用将如何增长，然后你就会保守地设计你的系统。举个例子，应用中与其他系统进行通信的模块将来可能会改变，因此你需要将它抽象出来。” - <strong>Nicholas Zakas, author ‘High-performance JavaScript websites’</strong></p>

<p class="j-warning">“组件之间关系越紧密，它们就越难以复用，对组件的修改就越困难，因为难免会影响到其他组件。” - <strong>Rebecca Murphey, author of jQuery Fundamentals</strong></p>

<p>这些原则对于构建经久考验的架构至关重要，应该始终牢记于心。</p>
<h2 id="头脑风暴"><a href="#头脑风暴" class="headerlink" title="头脑风暴"></a>头脑风暴</h2><p>先想想我们试图实现什么。</p>
<p class="j-warning">我们想要一个松散耦合的架构，功能被分解为<strong>独立的模块</strong>，模块之间没有依赖。当触发某个事件时，模块将<strong>通知</strong>应用程序的其他部分，并由一个<strong>中间层</strong>来解析和响应这些消息。</p>

<p>例如，我们有一个在线面包店的 JavaScript 应用，那么模块中这个“事件”的就可能是“第 42 批面包卷已经准备好派送”。</p>
<p>我们使用一个独立的模块解析其他模块中的消息，这样，模块不会直接调用核心模块，同时，模块不需要直接调用其它模块或与其它模块进行交互。这可以防止由某个模块出错而导致应用程序崩溃，并给我们提供了一种重启崩溃模块的方式。</p>
<p>另一个是安全问题。事实上，大多数人不会认为应用程序的内部安全是个问题,因为他们认为自己足够聪明，构建应用时，清楚地知道哪些是公共的哪些是私有的。</p>
<p>模块不应该是万能的，需要确定某个模块允许做什么不能做什么。例如，在我的系统中，如果我知道公共聊天组件不允许与管理模块或拥有 DB 写权限的模块发生交互，就可以防止别人利用组件中已知的漏洞来发起 XSS 攻击。</p>
<p>用一个中间层来处理权限，确定哪些模块可以访问应用的哪些部分，这样可以增加应用的安全性。这意味着，一个模块只能做那些被允许的事情。</p>
<h2 id="推荐架构"><a href="#推荐架构" class="headerlink" title="推荐架构"></a>推荐架构</h2><p>我所寻求的解决方案由三个著名的设计模式组成：<strong>模块模式</strong>、<strong>外观模式</strong>和<strong>中介模式</strong>。</p>
<p>在传统模式中，模块间直接相互通信，在我们的架构中，模块只会发布感兴趣的事件，理想情况下，一个模块不会感知到其他模块的存在。中介模式用来订阅模块中的消息，并作出适当的响应。外观模式用于执行模块对应的功能。</p>
<p>我将详细讨论下面这些内容：</p>
<ul>
<li>设计模式<ul>
<li>模块化理论<ul>
<li><a href="#modtheory">概要</a></li>
<li><a href="#modpattern">模块模式</a></li>
<li><a href="#objliteral">对象字面量</a></li>
<li><a href="#commonjsmods">CommonJS 模块</a></li>
</ul>
</li>
<li><a href="#facadepattern">外观模式</a></li>
<li><a href="#mediatorpattern">中介模式</a> </li>
</ul>
</li>
<li>在架构中的应用<ul>
<li><a href="#applyingfacade">应用外观模式 - 抽象的核心</a></li>
<li><a href="#applyingmediator">应用中介模式 - 应用程序核心</a></li>
<li><a href="#tyingittogether">集成应用</a>   </li>
</ul>
</li>
</ul>
<h3 id="模块化理论"><a href="#模块化理论" class="headerlink" title="模块化理论"></a>模块化理论</h3><p><a name="modtheory"></a></p>
<p>也许你已经使用过模块化开发，如果还没有，本节将是一个入门的简单例子。</p>
<p class="j-warning">模块是任何健壮架构中<strong>不可或缺</strong>的一部分，在大型系统中，模块是通常具有单一目，并具有通用性的部分。</p>

<p>可以为模块定义好依赖关系，并立即自动加载这些依赖项，这种方式更具可伸缩性，不必跟踪模块依赖和手动加载模块或注入 <code>&lt;script&gt;</code> 标签。</p>
<p>任何成体系的应用都应该基于模块化组件来构建。回到刚刚的 GMail 应用，可以认为模块是独立存在的功能单元，如聊天功能模块。但是，还取决于功能单元的复杂度，它很可能还依赖于更细粒度的子模块。例如，有一个处理表情符号的模块，可以被使用在聊天应用和邮件应用中。</p>
<p class="j-warning">在我们的架构中，模块<strong>很少感知</strong>系统中的其余模块发生的事情。我们可以通过外观模式将这个任务委托给中介。</p>

<p>这是刻意这样设计的，一个模块只让系统知道它正在发生的事情，而不需要关心其他模块的运行情况，系统就能够支持添加、删除或替换模块，不会因为紧耦合而导致系统中其他模块崩溃。</p>
<p>要想实现这个想法，松散耦合是必要的。在可能的地方移除代码依赖有助于提高模块的可维护性。在我们的例子中，模块不应该依赖其他模块就能正常运行。当松散耦合得到有效实施时，看看系统中一个部位的更改将如何影响其它部位。</p>
<p>在 JavaScript 中，有几种方式来实现模块化，包括著名的模块模式和对象字面量，有经验的开发人员已经熟悉这些，如果你也已经熟悉，请跳到 <a href="#commonjsmods">CommonJS 模块</a>部分。</p>
<h3 id="模块模式-the-module-pattern"><a href="#模块模式-The-Module-Pattern" class="headerlink" title="模块模式 The Module Pattern"></a>模块模式 The Module Pattern</h3><p><a name="modpattern"></a></p>
<p>模块模式是一个流行的设计模式，通过闭包来封装“私有”、状态和结构。它提供一种包装公共和私有方法和变量的方式，避免污染全局变量或与其他开发人员的接口发生冲突。这种模式，只返回一些公共的 API，剩下的一切则是私有的。</p>
<p>这提供了一个纯净的解决方案，将逻辑繁重的部分保护在其中，值暴露出接口给应用的其他部位调用。这种模式非常类似于一个立即执行的函数（<a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/" target="_blank" rel="external">IIFE</a>），除了返回的是一个对象，而不是函数。</p>
<p>需要指出的是，在 JavaScript 中并不存在真正意义上的“私有”，因为 JavaScript 不同于一些传统的语言，变量不能被声明为公共或私有的，所以我们使用函数作用域来模拟这一概念。在模块模式中，利用闭包，声明的变量和方法只在模块内部可用，在返回的对象中定义的变量和方法才是随处可用的。</p>
<p>下面你将看到一个用模块模式实现的购物车应用，模块被包含在 <code>basketModule</code> 这个全局对象中。模块中的 <code>basket</code> 数组是私有的，因此应用的其它部分不能直接读取它，它只存在于模块的闭包中，所以只有那些与它同作用域的方法（例如，<code>addItem()</code>, <code>getItem()</code> 等等）才能访问到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> basketModule = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> basket = []; <span class="comment">//private</span></div><div class="line">    <span class="keyword">return</span> &#123; <span class="comment">//exposed to public</span></div><div class="line">        addItem: <span class="function"><span class="keyword">function</span>(<span class="params">values</span>) </span>&#123;</div><div class="line">            basket.push(values);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">getItemCount</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> basket.length;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">getTotal</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">           <span class="keyword">var</span> q = <span class="keyword">this</span>.getItemCount(),p=<span class="number">0</span>;</div><div class="line">            <span class="keyword">while</span>(q--)&#123;</div><div class="line">                p+= basket[q].price; </div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> p;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<p>在模块中，我们返回了一个对象，并自动赋给了 <code>basketModule</code>，因此，你可以这样来使用它：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//basketModule is an object with properties which can also be methods</span></div><div class="line">basketModule.addItem(&#123;<span class="attr">item</span>:<span class="string">'bread'</span>,<span class="attr">price</span>:<span class="number">0.5</span>&#125;);</div><div class="line">basketModule.addItem(&#123;<span class="attr">item</span>:<span class="string">'butter'</span>,<span class="attr">price</span>:<span class="number">0.3</span>&#125;);</div><div class="line"> </div><div class="line"><span class="built_in">console</span>.log(basketModule.getItemCount());</div><div class="line"><span class="built_in">console</span>.log(basketModule.getTotal());</div><div class="line"> </div><div class="line"><span class="comment">//however, the following will not work:</span></div><div class="line"><span class="built_in">console</span>.log(basketModule.basket);<span class="comment">// (undefined as not inside the returned object)</span></div><div class="line"><span class="built_in">console</span>.log(basket); <span class="comment">//(only exists within the scope of the closure)</span></div></pre></td></tr></table></figure>
<p>上面的方法被有效地限制在 <code>basketModule</code> 命名空间中。</p>
<p>从历史角度来看，模块模式最早在 2003 年由许多人创建，包括 <a href="http://groups.google.com/group/comp.lang.javascript/msg/9f58bd11bd67d937" target="_blank" rel="external">Richard Cornford</a>，后来在道格拉斯(Douglas Crockford)的演讲中被推广，并被 Eric Miraglia 在 YUI 的博客中再次介绍。</p>
<p>在具体的工具库或框架中，模块模式是什么样的情况呢？</p>
<h4 id="dojo"><a href="#Dojo" class="headerlink" title="Dojo"></a>Dojo</h4><p>Dojo 试图通过 <code>dojo.declare</code> 来实现类似于“类”的功能，这个也可用于实现模块模式。例如，如果我们想把 <code>basket</code> 定义在 <code>store</code> 命名空间下，可以这样来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//traditional way</span></div><div class="line"><span class="keyword">var</span> store = <span class="built_in">window</span>.store || &#123;&#125;;</div><div class="line">store.basket = store.basket || &#123;&#125;;</div><div class="line"> </div><div class="line"><span class="comment">//using dojo.setObject</span></div><div class="line">dojo.setObject(<span class="string">"store.basket.object"</span>, (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> basket = [];</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">privateMethod</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(basket);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">publicMethod</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                privateMethod();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;()));</div></pre></td></tr></table></figure>
<p>如果混合使用 <code>dojo.provide</code> 将变得非常强大。</p>
<h4 id="yui"><a href="#YUI" class="headerlink" title="YUI"></a>YUI</h4><p>下面的例子在很大程度上基于由 Eric Miraglia 实现的原始的 YUI 模块模式，代码相对来说比较不言自明。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">YAHOO.store.basket = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">//"private" variables:</span></div><div class="line">    <span class="keyword">var</span> myPrivateVar = <span class="string">"I can be accessed only within YAHOO.store.basket ."</span>;</div><div class="line"> </div><div class="line">    <span class="comment">//"private" method:</span></div><div class="line">    <span class="keyword">var</span> myPrivateMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            YAHOO.log(<span class="string">"I can be accessed only from within YAHOO.store.basket"</span>);</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">myPublicProperty</span>: <span class="string">"I'm a public property."</span>,</div><div class="line">        <span class="attr">myPublicMethod</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            YAHOO.log(<span class="string">"I'm a public method."</span>);</div><div class="line"> </div><div class="line">            <span class="comment">//Within basket, I can access "private" vars and methods:</span></div><div class="line">            YAHOO.log(myPrivateVar);</div><div class="line">            YAHOO.log(myPrivateMethod());</div><div class="line"> </div><div class="line">            <span class="comment">//The native scope of myPublicMethod is store so we can</span></div><div class="line">            <span class="comment">//access public members using "this":</span></div><div class="line">            YAHOO.log(<span class="keyword">this</span>.myPublicProperty);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">&#125;();</div></pre></td></tr></table></figure>
<h4 id="jquery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h4><p>有许多方式可以将 jQuery 代码包装在模块模式中。Ben Cherry 之前提出了一个实现方式，用一个函数将模块定义包装起来，模块定义时处理一些共性事件。</p>
<p>在下面例子中，定义了一个 <code>library</code> 函数来创建一个模块，当一个新模块被创建时，自动将 <code>init</code> 函数绑定到 <code>document.ready</code> 上。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">library</span>(<span class="params">module</span>) </span>&#123;</div><div class="line">  $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">module</span>.init) &#123;</div><div class="line">      <span class="built_in">module</span>.init();</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">return</span> <span class="built_in">module</span>;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">var</span> myLibrary = library(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="keyword">return</span> &#123;</div><div class="line">     <span class="attr">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">       <span class="comment">/*implementation*/</span></div><div class="line">     &#125;</div><div class="line">   &#125;;</div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<p class="j-info"><strong>相关阅读</strong><br>- <a href="http://www.adequatelygood.com/2010/3/JavaScript-Module-Pattern-In-Depth" target="_blank" rel="external">Ben Cherry - The Module Pattern In-Depth</a><br>- <a href="http://lanyrd.com/2011/jsconf/sfgdk/" target="_blank" rel="external">John Hann - The Future Is Modules, Not Frameworks</a><br>- <a href="https://gist.github.com/274388" target="_blank" rel="external">Nathan Smith - A Module pattern aliased window and document gist</a><br>- <a href="http://blog.davidlitmark.com/post/6009004931/an-introduction-to-the-revealing-module-pattern" target="_blank" rel="external">David Litmark - An Introduction To The Revealing Module Pattern</a><br></p>


<h3 id="对象字面量-object-literal-notation"><a href="#对象字面量-Object-Literal-Notation" class="headerlink" title="对象字面量 Object Literal Notation"></a>对象字面量 Object Literal Notation</h3><p><a name="objliteral"></a></p>
<p>在对象字面量中，一个对象被描述为一组用逗号分隔的键/值对，并用一对 <code>{}</code> 包裹起来。对象中的名词可以是字符串或标识符，其后紧跟一个冒号 <code>:</code>。在对象的最后一个键/值对后面不能有逗号，因为这可能导致错误。</p>
<p>对象字面量不需要用 <code>new</code> 操作符来实例化，但是不能在语句的开始使用，因为 <code>{</code> 可能会被解析为语句块的开始。在下面你可以看到，使用对象字面量来定义一个模块，可以使用 <code>myModule.property = &#39;someValue&#39;</code> 的方式来给对象添加新成员。</p>
<p class="j-warning">模块模式在很多情况下很有用，但是，如果你不需要特定的私有属性或方法，那么对象字面量无疑是更合适的代替品。</p>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myModule = &#123;</div><div class="line">    <span class="attr">myProperty</span> : <span class="string">'someValue'</span>,</div><div class="line">    <span class="comment">//object literals can contain properties and methods.</span></div><div class="line">    <span class="comment">//here, another object is defined for configuration</span></div><div class="line">    <span class="comment">//purposes:</span></div><div class="line">    myConfig:&#123;</div><div class="line">        <span class="attr">useCaching</span>:<span class="literal">true</span>,</div><div class="line">        <span class="attr">language</span>: <span class="string">'en'</span>   </div><div class="line">    &#125;,</div><div class="line">    <span class="comment">//a very basic method</span></div><div class="line">    myMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'I can haz functionality?'</span>);</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">//output a value based on current configuration</span></div><div class="line">    myMethod2: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'Caching is:'</span> + (<span class="keyword">this</span>.myConfig.useCaching)?<span class="string">'enabled'</span>:<span class="string">'disabled'</span>);</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">//override the current configuration</span></div><div class="line">    myMethod3: <span class="function"><span class="keyword">function</span>(<span class="params">newConfig</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> newConfig == <span class="string">'object'</span>)&#123;</div><div class="line">           <span class="keyword">this</span>.myConfig = newConfig;</div><div class="line">           <span class="built_in">console</span>.log(<span class="keyword">this</span>.myConfig.language); </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">myModule.myMethod(); <span class="comment">//I can haz functionality</span></div><div class="line">myModule.myMethod2(); <span class="comment">//outputs enabled</span></div><div class="line">myModule.myMethod3(&#123;<span class="attr">language</span>:<span class="string">'fr'</span>,<span class="attr">useCaching</span>:<span class="literal">false</span>&#125;); <span class="comment">//fr</span></div></pre></td></tr></table></figure>
<p class="j-info"><strong>相关阅读</strong><br>- <a href="http://blog.rebeccamurphey.com/2009/10/15/using-objects-to-organize-your-code" target="_blank" rel="external">Rebecca Murphey - Using Objects To Organize Your Code</a><br>- <a href="http://www.phpied.com/3-ways-to-define-a-javascript-class/" target="_blank" rel="external">Stoyan Stefanov - 3 Ways To Define A JavaScript Class </a><br>- <a href="http://benalman.com/news/2010/03/theres-no-such-thing-as-a-json/" target="_blank" rel="external">Ben Alman - Clarifications On Object Literals (There’s no such thing as a JSON Object)</a><br>- <a href="http://ejohn.org/blog/simple-javascript-inheritance/" target="_blank" rel="external">John Resig - Simple JavaScript Inheritance</a><br></p>

<h3 id="commonjs-模块-commonjs-modules"><a href="#CommonJS-模块-CommonJS-Modules" class="headerlink" title="CommonJS 模块 CommonJS Modules"></a>CommonJS 模块 CommonJS Modules</h3><p><a name="commonjsmods"></a></p>
<p>在过去的一两年，你可能已经听说过 <a href="http://commonjs.org/" target="_blank" rel="external">CommonJS</a> - 一个致力于设计、原型化和标准化 JavaScript API 的志愿者工作组。目前，他们已经批准了模块和包的标准，CommonJS AMD 规范定义了一个简单的 API 来声明模块，模块可同时用于浏览器的同步和异步的 <code>&lt;script&gt;</code> 标签中。他们的模块模式相对比较清爽，并且我认为它是 ES Harmony（JavaScript 语言的下一个版本）所建议的模块系统的可靠基石。</p>
<p>从结构的角度来看，一个 CommonJS 模块是一段可重用的 JavaScript，它输出特定的对象，以供任何依赖它的代码调用。这种模块格式变得相当普遍，成为 JS 模块格式事实上的标准。有很多关于实现 CommonJS 模块模式的教程，单高度概括起来，都包含两个基本部分：一个 <code>exports</code> 对象，包含了对其他模块可用的对象；一个 <code>require</code> 函数，用来导入其他模块暴露的对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">Example of achieving compatibility with AMD and standard CommonJS by putting boilerplate around the standard CommonJS module format:</div><div class="line">*/</div><div class="line"></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">define</span>)</span>&#123;</div><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports</span>)</span>&#123;</div><div class="line"><span class="comment">// module contents</span></div><div class="line"> <span class="keyword">var</span> dep1 = <span class="built_in">require</span>(<span class="string">"dep1"</span>);</div><div class="line"> exports.someExportedFunction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;...&#125;;</div><div class="line"> <span class="comment">//...</span></div><div class="line">&#125;);</div><div class="line">&#125;)(<span class="keyword">typeof</span> define==<span class="string">"function"</span>?define:<span class="function"><span class="keyword">function</span>(<span class="params">factory</span>)</span>&#123;factory(<span class="built_in">require</span>,exports)&#125;);</div></pre></td></tr></table></figure>
<p>有许多强大的库可以处理 CommonJS 模块的加载，但我虽喜欢的是 RequireJS。一个完整的 RequireJS 教程超出了本文的范围，不过我推荐你读一读 James Burke 的博文 <a href="http://msdn.microsoft.com/en-us/scriptjunkie/ff943568" target="_blank" rel="external">ScriptJunkie</a>。我知道很多人也喜欢 Yabble。</p>
<p>扯些题外话，RequireJS 提供了一些包装方法，来简化静态模块的创建过程和异步加载。它可以很容易的加载模块以及模块的依赖，然后在模块就绪时执行模块的内容。</p>
<p>有些开发人员声称 CommonJS 模块不太适用于浏览器环境。原因是 CommonJS 模块无法通过 <code>&lt;script&gt;</code> 标签加载，除非有服务端协助。我们假设有一个把图片编码为 ASCII 的库，它暴露出一个 <code>encodeToASCII</code> 函数。它的模块类似于：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> encodeToASCII = <span class="built_in">require</span>(<span class="string">"encoder"</span>).encodeToASCII;</div><div class="line">exports.encodeSomeSource = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//process then call encodeToASCII</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这类情况下，<code>&lt;script&gt;</code> 标签将无法正常工作，因为作用域没有被包裹起来，这就意味着 <code>encodeToASCII</code> 方法将被绑定到 <code>window</code> 对象上，<code>require</code> 也不是之前的定义，并且需要为每个模块单独创建 exports。客户端在服务器端的协助下，或通过发送 XHR 请求加载脚本，并使用 <code>eval()</code> 函数，可以很容易处理这种情况。</p>
<p>使用 RequireJS，该模块的早期版本可以重写为下面这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> encodeToASCII = <span class="built_in">require</span>(<span class="string">"encoder"</span>).encodeToASCII;</div><div class="line">    exports.encodeSomeSource = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="comment">//process then call encodeToASCII</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>对于不只依赖于静态 JavaScript 的项目来说，CommonJS 是很好的选择，不过先要花一些时间来阅读相关资料。我仅仅涉及到了冰山一角，如果你想深入阅读，CommonJS 的 wikie 和 Sitepen 有着大量资源。</p>
<p class="j-info"><strong>相关阅读</strong><br>- <a href="http://wiki.commonjs.org/wiki/Modules" target="_blank" rel="external">The CommonJS Module Specifications</a><br>- <a href="http://dailyjs.com/2010/10/18/modules/" target="_blank" rel="external">Alex Young - Demystifying CommonJS Modules</a><br>- <a href="http://requirejs.org/docs/commonjs.html#packages" target="_blank" rel="external">Notes on CommonJS modules with RequireJS</a><br></p>

<h3 id="外观模式-the-facade-pattern"><a href="#外观模式-The-Facade-Pattern" class="headerlink" title="外观模式 The Facade Pattern"></a>外观模式 The Facade Pattern</h3><p><a name="facadepattern"></a></p>
<p>接下来，我们来看看外观模式，在今天定义的架构中扮演着关键角色的设计模式。</p>
<p>当创建一个外观模式时，通常是创建了一个隐藏了不同实现的外在表现。外观模式为大批量代码提供了一个方便的高级接口，隐藏了底层的复杂性，呈现给其他开发人员的是简化的 API。</p>
<p>外观模式是一种结构模式，经常可以在 JavaScript 框架和库中看到，尽管它的实现可能提供能大量行为，但只有一个“外观”或一些有限的抽象方法供客户使用。</p>
<p>这样，我们直接与“外观”交互，而不是隐藏在其后的子系统。</p>
<p>外观模式有趣之处在于，它可以隐藏各个功能模块的内部实现细节，甚至可以在客户不知情的情况下修改其内部实现。</p>
<p>通过维护一个一致性的外观（简化的 API），就不必担心一个模块是否使用了 dojo、jQuery、YUI、zepto 或其他库。只要交互层没有改变，你就可以更换我们的库（如，jQuery 或 Dojo）而不会影响系统的其他部分。</p>
<p>下面是一个非常简单的外观模式的示例，正如你所看到的，在我们的模块内部定义了许多私有方法，然后使用外观模式来为这些方法提供了一个更简单的 API。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> <span class="built_in">module</span> = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> _private = &#123;</div><div class="line">        <span class="attr">i</span>:<span class="number">5</span>,</div><div class="line">        <span class="attr">get</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'current value:'</span> + <span class="keyword">this</span>.i);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">set</span> : <span class="function"><span class="keyword">function</span>(<span class="params"> val </span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.i = val;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">run</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'running'</span>);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">jump</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'jumping'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">facade</span> : <span class="function"><span class="keyword">function</span>(<span class="params"> args </span>) </span>&#123;</div><div class="line">            _private.set(args.val);</div><div class="line">            _private.get();</div><div class="line">            <span class="keyword">if</span> ( args.run ) &#123;</div><div class="line">                _private.run();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;());</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="built_in">module</span>.facade(&#123;<span class="attr">run</span>: <span class="literal">true</span>, <span class="attr">val</span>:<span class="number">10</span>&#125;);</div><div class="line"><span class="comment">//outputs current value: 10, running</span></div></pre></td></tr></table></figure>
<p>在将其应用到我们的架构之前，先介绍到这里。接下来，我们将进入激动人心的中介模式，外观模式和中介模式的核心区别在于，外观模式（一种结构模式）只暴露了现有功能，而中介模式（一种行为模式）可以添加功能。</p>
<p class="j-info"><strong>相关阅读</strong><br>- <a href="http://books.google.co.uk/books?id=za3vlnlWxb0C&amp;lpg=PA141&amp;ots=MD5BLTsSzH&amp;dq=javascript%20facade%20pattern&amp;pg=PA141#v=onepage&amp;q=javascript facade pattern&amp;f=false" target="_blank" rel="external">Dustin Diaz, Ross Harmes - Pro JavaScript Design Patterns (Chapter 10, available to read on Google Books)</a><br></p>


<h3 id="中介模式-the-mediator-pattern"><a href="#中介模式-The-Mediator-Pattern" class="headerlink" title="中介模式 The Mediator Pattern"></a>中介模式 The Mediator Pattern</h3><p><a name="mediatorpattern"></a></p>
<p>机场交通控制 - 这个简单的比喻最好地诠释了中介模式。航站楼控制着哪个飞机可以起飞或降落，因为所有的沟通都是通过航站楼和飞机之间进行，而不是飞机与飞机之间直接沟通。这个系统成功的关键在于中央控制器，即所谓的中介。</p>
<p class="j-warning">当模块之间通信比较复杂时可以使用中介，单决定权还是在我们自己。如果在你的代码中，模块之间有千丝万缕的关系，就是时候实施一个中央控制器，这就是中介模式的用武之地。</p>

<p>回到我们的讨论，中介模式在不同模块之间的<strong>交互</strong>过程中充当了中介角色，将交互细节都<strong>封装</strong>在了内部。通过阻止对象之间相互引用，这种模式还促进了松散耦合，解决了模块内部依赖问题。</p>
<p>中介模式还有什么其他优势呢？嗯，中介模式允许各个模块的行为独立变化，因此相当灵活。如果你之前使用过观察者模式（发布/订阅模式）来实现模块之间的事件广播，你会发现中介模式相当好理解。</p>
<p>让我们看看模块是如何与中介交互的：</p>
<p><img src="http://bubkoo.qiniudn.com/modules-interact-with-a-mediator.jpg" alt=""></p>
<p>模块是发布者，中介既是发布者又是订阅者。模块 1 广播一个事件来通知中介需呀做点什么，中介捕获到该事件后，通知模块 2 去完成模块 1 需要的任务，并向中介者广播一个完成事件。同时，模块 3 也被中介启动，记录从中介传来的通知。</p>
<p>注意，任何模块之间都没有<strong>直接通信</strong>，如果作用链中的模块 3 运行失败或意外停止，中介可以假装“暂停”其他模块的任务，停止并重启模块 3，然后继续工作，这对系统而言几乎没有影响。这种层级解耦是中介模式提供的最主要优势之一。</p>
<p>回顾一些，中介者模式的优势如下：</p>
<p>引入中介作为中央控制点来使模块解耦。允许模块监听或广播消息，而不用关心系统的其余部分。消息可以同时被任意数量的模块来处理。</p>
<p>缺点是：</p>
<p>在模块之间添加中介，模块始终必须间接沟通。由于松散耦合的本资，这可能会导致轻微的性能下降，而且很难通过广播消息得知系统将如何响应。如果有一天，紧耦合让你头痛，这也许是一个解决方案。</p>
<p><strong>示例</strong>：这是中介者模式的一个实现，基于 <a href="https://github.com/rpflorence" target="_blank" rel="external">@rpflorence</a> 之前的工作成果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mediator = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> subscribe = <span class="function"><span class="keyword">function</span>(<span class="params">channel, fn</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span> (!mediator.channels[channel]) mediator.channels[channel] = [];</div><div class="line">        mediator.channels[channel].push(&#123; <span class="attr">context</span>: <span class="keyword">this</span>, <span class="attr">callback</span>: fn &#125;);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;,</div><div class="line"> </div><div class="line">    publish = <span class="function"><span class="keyword">function</span>(<span class="params">channel</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span> (!mediator.channels[channel]) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = mediator.channels[channel].length; i &lt; l; i++) &#123;</div><div class="line">            <span class="keyword">var</span> subscription = mediator.channels[channel][i];</div><div class="line">            subscription.callback.apply(subscription.context, args);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">channels</span>: &#123;&#125;,</div><div class="line">        <span class="attr">publish</span>: publish,</div><div class="line">        <span class="attr">subscribe</span>: subscribe,</div><div class="line">        <span class="attr">installTo</span>: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">            obj.subscribe = subscribe;</div><div class="line">            obj.publish = publish;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"> </div><div class="line">&#125;());</div></pre></td></tr></table></figure>
<p><strong>示例</strong>：下面是前面实现的两个使用示例，有效管理了发布/订阅。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Pub/sub on a centralized mediator</span></div><div class="line"></div><div class="line">mediator.name = <span class="string">"tim"</span>;</div><div class="line">mediator.subscribe(<span class="string">'nameChange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">        <span class="keyword">this</span>.name = arg;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">mediator.publish(<span class="string">'nameChange'</span>, <span class="string">'david'</span>); <span class="comment">//tim, david</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//Pub/sub via third party mediator</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">'sam'</span> &#125;;</div><div class="line">mediator.installTo(obj);</div><div class="line">obj.subscribe(<span class="string">'nameChange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">        <span class="keyword">this</span>.name = arg;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">obj.publish(<span class="string">'nameChange'</span>, <span class="string">'john'</span>); <span class="comment">//sam, john</span></div></pre></td></tr></table></figure>
<p class="j-info"><strong>相关阅读</strong><br>- Stoyan Stefanov - Page 168, JavaScript Patterns<br>- <a href="http://arguments.callee.info/2009/05/18/javascript-design-patterns--mediator/" target="_blank" rel="external">HB Stone - JavaScript Design Patterns: Mediator</a><br>- <a href="http://www.vincehuston.org/dp/mediator.html" target="_blank" rel="external">Vince Huston - The Mediator Pattern (not specific to JavaScript, but a concise)</a><br></p>

<h3 id="应用外观模式-抽象的核心"><a href="#应用外观模式-抽象的核心" class="headerlink" title="应用外观模式 - 抽象的核心"></a>应用外观模式 - 抽象的核心</h3><p><a name="applyingfacade"></a></p>
<p>架构建议：</p>
<p class="j-warning">外观模式作为应用程序核心的<strong>抽象</strong>，位于中介和模块之间。理想情况下，它应该是系统中其他部分唯一可以感知到的部分。</p>

<p>抽象的责任包括为模块提供<strong>统一的接口</strong>，并确保任何时候都是可用的。这非常类似于 Nicholas Zakas 首次提出的优秀架构中的沙箱控制器角色。</p>
<p>组件将通过外观与中介通信，所以外观必须是可靠的。需要澄清的是，我所说的“通信”实际上是指与外观进行通信，外观是中介者的抽象，将监听模块的广播消息，然后把广播消息传给中介。</p>
<p>除了为模块提供接口，外观还扮演着保安的角色，确定了一个模块可以访问应用中的哪些部分。组件只能调用自己的方法，对于没有权限的部分，则不能与之交互。例如，一个模块可能广播 <code>dataValidationCompletedWriteToDB</code> 消息，这里的安全检查是确保有权限的模块才能请求数据库写操作。我们最好避免让模块视图做一下不被允许的事情。</p>
<p>总之，中介管理发布/订阅，只有通过外观检查的消息才会被传给中介。</p>
<h3 id="应用中介者模式-应用程序核心"><a href="#应用中介者模式-应用程序核心" class="headerlink" title="应用中介者模式 - 应用程序核心"></a>应用中介者模式 - 应用程序核心</h3><p><a name="applyingmediator"></a></p>
<p>中介扮演的角色是应用程序的核心。我们已经简单介绍了它的一些职责，我们还需要完整的来看看它的左右职责。</p>
<p>中介的主要任务是管理模块的<strong>生命周期</strong>。当中介检查到一个<strong>消息</strong>时，它需要决定应用程序该如何响应 – 这实际上意味着是否需要<strong>停止</strong>或<strong>启动</strong>一个或一组模块。</p>
<p class="j-warning">理想情况下，模块一旦启动，就应该<strong>自动</strong>执行。模块是否应该在 DOM 就绪时才执行，决定这个的不是中介的职责，架构中应该有足够的空间来让模块自己来决定。</p>

<p>你可能想知道在什么情况下一个模块需要被“停止” – 如果应用程序侦测到某个模块出现故障或处于严重的错误中，可以决定让阻止模块中的方法继续执行，这时就可以重新启动模块。这样做的目的减少中断，提高用户体验。</p>
<p>此外，中介（应用核心）应该可以<strong>添加或移除</strong>模块，而不破坏任何东西。一个典型的应用场景是，某些功能不是在页面初始化的时候加载，而是基于用户意图动态加载，回到 GMail 的例子，谷歌可以聊天部件默认收起，只有当用户开始使用时才动态加载。从性能优化的角度来看，这是非常有意义的。</p>
<p>错误管理也是由应用程序核心负责。模块除了广播感兴趣的事件之外，还会广播发生的任何错误，然后核心可以做出相应的反馈（例如停止或重启模块）。确保应用有足够的灵活空间，来引入新的或更好的方式来处理错误或向终端用户显示错误，这是解耦架构中的重要环节。通过中介者使用发布/订阅机制，就可以做到这一点。</p>
<h3 id="集成应用-tying-it-all-together"><a href="#集成应用-Tying-It-All-Together" class="headerlink" title="集成应用 Tying It All Together"></a>集成应用 Tying It All Together</h3><p><a name="tyingittogether"></a></p>
<ul>
<li><p><strong>模块</strong>为应用程序提供特定的功能。每当发生了某些事件，它们发布消息来告知应用程序 – 这是它们的主要关注点。正如我将在 FAQ 中介绍的，模块可以依赖 DOM 工具方法，但是理想情况下不应该依赖系统中的任何其他模块。它们不应该关注：</p>
<ul>
<li>什么对象或模块将订阅它们发布的消息</li>
<li>这些对象在哪里（是否在客户端或服务器端）</li>
<li>有多少对象订阅了它的消息</li>
</ul>
<p><img src="http://bubkoo.qiniudn.com/tying-it-all-together-chart1a.gif" alt=""></p>
</li>
<li><p><strong>外观</strong> 抽象的核心，避免模块之间直接接触。它从模块订阅感兴趣的事件，并说：“太棒了！发生了什么事情？给我细节！”它还通过检查发布消息的模块是否具有相应的权限，来检查模块的安全性。</p>
<p><img src="http://bubkoo.qiniudn.com/tying-it-all-together-chart2a.gif" alt=""></p>
</li>
<li><p>中介者（应用程序的核心） 扮演“发布/订阅”管理者的角色。负责管理模块，在需要时启动或停止模块。特别适用于动态依赖加载，并确保失败的模块可以在需要时集中重启。</p>
<p><img src="http://bubkoo.qiniudn.com/tying-it-all-together-chart3a.gif" alt=""></p>
</li>
</ul>
<p>这种架构的结果是，在大多数情况下，模块之间不会相互依赖，这是因为这种解耦架构，模块很容易独立进行测试和维护，可以将模块用于另一个项目，而不需要太多额外的工作。模块可以被动态添加或移除，而不会导致应用程序崩溃。</p>
<h2 id="超越beyond发布订阅自动事件注册"><a href="#超越-Beyond-发布-订阅：自动事件注册" class="headerlink" title="超越(Beyond)发布/订阅：自动事件注册"></a>超越(Beyond)发布/订阅：自动事件注册</h2><p>正如 Michael Mahemoff 之前提到，当考虑大型 JavaScript 应用时，适当利用这门语言的动态特性是有益的。关于详细内容请阅读 Michael <a href="https://plus.google.com/106413090159067280619/posts/hDZkVrDXZR6" target="_blank" rel="external">G+</a> 上列举的概念，我最关注一个特别的概念 – 自动事件注册（AER）。</p>
<p>AER 通过基于命名约定的自动连接模式，解决了从订阅者到发布者的连接问题。例如，如果某个模块发布了 <code>messageUpdate</code> 消息，所有与 <code>messageUpdate</code> 相关的方法将被自动调用。</p>
<p>这种模式涉及到：注册所有可能订阅事件的模块，注册所有可能被订阅的事件，最后为组件库中的每个订阅者注册方法。对于这篇文章所讨论的架构来说，这是一个非常有趣的方法，但也确实带来一些有趣的挑战。</p>
<p>例如，当动态执行时，对象可以在创建时注册自身。请阅读 Michael 关于 AER 的<a href="http://softwareas.com/automagic-event-registration" target="_blank" rel="external">文章</a>，他更深入地讨论了如何处理这类问题。</p>
<h2 id="常问问题"><a href="#常问问题" class="headerlink" title="常问问题"></a>常问问题</h2><p><strong>Q: 是否可以完全避免实现一个沙箱或外观？</strong><br>A: 虽然前面的介绍中使用了外观来实现安全功能，如果不用外观，完全可以通过中介和发布/订阅机制来做系统中的通信。这种轻量级版本可以提供一定程度的解耦，但是如果这么做，模块就可以直接与应用程序核心（中介者）直接接触。</p>
<p><strong>Q: 您提到了模块没有任何依赖，这是否包含对第三方库的依赖（如jQuery）?</strong><br>A: 这里是指对其他模块的依赖。一些开发人员在架构中选择了一些 DOM 工具库，实际上是对这些 DOM 库的公共抽象。例如，你可以创建一个 DOM 工具类，使用 jQuery 来查询选择器表达式，并返回查找到的 DOM 结果（或者使用 Dojo）。通过这种方式，尽管模块依然会查询 DOM，但不会强依赖于特定的库。有许多方式可以实现这一点，但是理想情况下，核心模块不应该依赖其他模块。</p>
<p>这样做你会发现，有时候很容易就可以让一个完整的模块运行在另一个项目中。需要说清楚的是，我完全同意对模块进行扩展或使用模块的部分功能，但是记住，在某些情况下，想要把这样的模块应用到其他项目会增加工作量。</p>
<p><strong>Q: 我现在就想开始使用这种架构。是否有可供参考的样板代码？</strong><br>A: 如果时间允许的话，我打算为这篇文章发布一个样例程序，但目前你最好的选择是 Andrew Burgees 的超值教程 <a href="http://bit.ly/orGVOL" target="_blank" rel="external">Writing Modular JavaScript</a>（在推荐之前需要完全披露的是，这仅仅是一个推荐链接，收到的任何反馈都将有助于完善内容）。Andrew 的样例库包含一张屏幕截屏以及代码，覆盖了这篇文章的的大部分主要观点，但选择把外观称作“沙箱”，就像 Zakas。还有一些讨论是关于如何理想地在这样一个架构中实现 DOM 抽象库———类似于我对第二个问题的回答，Andrew 在实现选择器表达式查询时采用了一些有趣的模式，使得在大多数情况下，用短短几行代码就可以做到切换库。我并不是说它是正确的或最好的实现方式，但是它是一种可能，而且我个人也在使用它。</p>
<p><strong>Q: 如果模块需要直接与核心通信，这么做可能吗？</strong><br>A: 正如 Zakas 之前暗示的，为什么模块不应该访问核心，这在技术上并没有问题，但这是最佳实践，比其他任何事情都重要。如果你想严格地坚持这种架构，你需要遵循定义的这些规则，或者选择一个更松散的结构，就像第一个问题的答案。</p>
<p class="j-quote">参考原文：<a href="http://addyosmani.com/largescalejavascript/" target="_blank" rel="external">Patterns For Large-Scale JavaScript Application Architecture</a><br>原文作者：<a href="http://twitter.com/addyosmani" target="_blank" rel="external">Addy Osmani</a>.<br>技术评审：<a href="http://twitter.com/peolanha" target="_blank" rel="external">Andrée Hansson</a></p></section><footer class="article-footer clearfix"><div class="categories"><a href="/categories/javascript/" title="JavaScript">JavaScript</a></div><div class="tags"><a href="/tags/architecture/" title="Architecture">Architecture</a> <a href="/tags/patterns/" title="Patterns">Patterns</a></div></footer></div><nav class="article-nav clearfix"><a href="/2014/04/22/improve-cross-domain-communication-with-client-side-solutions/" class="article-nav-link article-nav-newer"><strong class="article-nav-type">Newer</strong><span class="article-nav-title">前端跨域通信解决方案</span></a><a href="/2014/04/21/http-cookies-explained/" class="article-nav-link article-nav-older"><strong class="article-nav-type">Older</strong><span class="article-nav-title">HTTP cookies 详解</span></a></nav></article><section id="article-comment" class="article-comment"><div data-thread-key="http://bubkoo.com/2014/04/21/patterns-for-large-scale-javascript-application-architecture/" data-title="大型 JavaScript 架构中的设计模式" data-url="http://bubkoo.com/2014/04/21/patterns-for-large-scale-javascript-application-architecture/" class="ds-thread"></div></section></div><aside id="sidebar" role="sidebar"><div class="widget tagcloud"><h3 class="widget-title">标签</h3><div class="widget-content"><a href="/tags/aop/" style="font-size: 10px">AOP</a> <a href="/tags/algorithm/" style="font-size: 18.33px">Algorithm</a> <a href="/tags/analysis/" style="font-size: 10px">Analysis</a> <a href="/tags/angularjs/" style="font-size: 15px">AngularJS</a> <a href="/tags/animation/" style="font-size: 10px">Animation</a> <a href="/tags/architecture/" style="font-size: 16.67px">Architecture</a> <a href="/tags/archives/" style="font-size: 10.83px">Archives</a> <a href="/tags/async/" style="font-size: 12.5px">Async</a> <a href="/tags/backbone/" style="font-size: 10px">Backbone</a> <a href="/tags/browsers/" style="font-size: 10px">Browsers</a> <a href="/tags/css/" style="font-size: 12.5px">CSS</a> <a href="/tags/css3/" style="font-size: 10px">CSS3</a> <a href="/tags/closure/" style="font-size: 10.83px">Closure</a> <a href="/tags/closures/" style="font-size: 10px">Closures</a> <a href="/tags/cookies/" style="font-size: 10px">Cookies</a> <a href="/tags/cross-domain/" style="font-size: 10px">Cross Domain</a> <a href="/tags/custom-elements/" style="font-size: 10.83px">Custom Elements</a> <a href="/tags/d3/" style="font-size: 10px">D3</a> <a href="/tags/debounce/" style="font-size: 10px">Debounce</a> <a href="/tags/debug/" style="font-size: 10.83px">Debug</a> <a href="/tags/dependency/" style="font-size: 10px">Dependency</a> <a href="/tags/document/" style="font-size: 10px">Document</a> <a href="/tags/ecma-262-3/" style="font-size: 15.83px">ECMA-262-3</a> <a href="/tags/ecmascript/" style="font-size: 15.83px">ECMAScript</a> <a href="/tags/es6/" style="font-size: 20px">ES6</a> <a href="/tags/errors/" style="font-size: 10px">Errors</a> <a href="/tags/essential/" style="font-size: 10px">Essential</a> <a href="/tags/evaluation-strategy/" style="font-size: 10px">Evaluation strategy</a> <a href="/tags/event/" style="font-size: 10px">Event</a> <a href="/tags/exceptions/" style="font-size: 10px">Exceptions</a> <a href="/tags/express/" style="font-size: 10px">Express</a> <a href="/tags/flip/" style="font-size: 10px">FLIP</a> <a href="/tags/flexbox/" style="font-size: 10px">Flexbox</a> <a href="/tags/funarg/" style="font-size: 10px">Funarg</a> <a href="/tags/gist/" style="font-size: 10px">Gist</a> <a href="/tags/github/" style="font-size: 10px">Github</a> <a href="/tags/guide/" style="font-size: 10px">Guide</a> <a href="/tags/html/" style="font-size: 10px">HTML</a> <a href="/tags/http/" style="font-size: 10px">HTTP</a> <a href="/tags/hexo/" style="font-size: 10.83px">Hexo</a> <a href="/tags/ie/" style="font-size: 10px">IE</a> <a href="/tags/iife/" style="font-size: 10px">IIFE</a> <a href="/tags/jshint/" style="font-size: 10px">JSHint</a> <a href="/tags/javascript/" style="font-size: 19.17px">JavaScript</a> <a href="/tags/leak/" style="font-size: 10px">Leak</a> <a href="/tags/linting/" style="font-size: 10px">Linting</a> <a href="/tags/mvc/" style="font-size: 10px">MVC</a> <a href="/tags/methodology/" style="font-size: 10px">Methodology</a> <a href="/tags/mock/" style="font-size: 10px">Mock</a> <a href="/tags/modular/" style="font-size: 10px">Modular</a> <a href="/tags/mongodb/" style="font-size: 10px">MongoDB</a> <a href="/tags/oop/" style="font-size: 10.83px">OOP</a> <a href="/tags/partial-application/" style="font-size: 10px">Partial Application</a> <a href="/tags/pattern/" style="font-size: 10px">Pattern</a> <a href="/tags/patterns/" style="font-size: 10px">Patterns</a> <a href="/tags/performance/" style="font-size: 14.17px">Performance</a> <a href="/tags/promise/" style="font-size: 13.33px">Promise</a> <a href="/tags/prototype/" style="font-size: 11.67px">Prototype</a> <a href="/tags/quality/" style="font-size: 10px">Quality</a> <a href="/tags/quiz/" style="font-size: 10px">Quiz</a> <a href="/tags/regex/" style="font-size: 10px">Regex</a> <a href="/tags/requirejs/" style="font-size: 10px">RequireJS</a> <a href="/tags/sass/" style="font-size: 10px">SASS</a> <a href="/tags/svg/" style="font-size: 10px">SVG</a> <a href="/tags/scope/" style="font-size: 10.83px">Scope</a> <a href="/tags/shapes/" style="font-size: 10px">Shapes</a> <a href="/tags/shuffle/" style="font-size: 10px">Shuffle</a> <a href="/tags/sort/" style="font-size: 17.5px">Sort</a> <a href="/tags/source-map/" style="font-size: 10.83px">Source Map</a> <a href="/tags/styling/" style="font-size: 10px">Styling</a> <a href="/tags/sublime-text/" style="font-size: 10px">Sublime Text</a> <a href="/tags/template/" style="font-size: 10px">Template</a> <a href="/tags/throttle/" style="font-size: 10px">Throttle</a> <a href="/tags/timing/" style="font-size: 10px">Timing</a> <a href="/tags/tools/" style="font-size: 12.5px">Tools</a> <a href="/tags/variable-object/" style="font-size: 10px">Variable object</a> <a href="/tags/visualizations/" style="font-size: 10px">Visualizations</a> <a href="/tags/when/" style="font-size: 12.5px">When</a> <a href="/tags/delete/" style="font-size: 10px">delete</a> <a href="/tags/execution-context/" style="font-size: 10px">execution context</a> <a href="/tags/fetch/" style="font-size: 10px">fetch</a> <a href="/tags/function/" style="font-size: 10px">function</a> <a href="/tags/nodejs/" style="font-size: 10px">nodejs</a> <a href="/tags/nodemon/" style="font-size: 10px">nodemon</a> <a href="/tags/npm/" style="font-size: 10px">npm</a> <a href="/tags/nvm/" style="font-size: 10px">nvm</a> <a href="/tags/performance/" style="font-size: 10px">performance</a> <a href="/tags/prebrowsing/" style="font-size: 10px">prebrowsing</a> <a href="/tags/prefetching/" style="font-size: 10px">prefetching</a> <a href="/tags/preloading/" style="font-size: 10px">preloading</a> <a href="/tags/tabindex/" style="font-size: 10px">tabindex</a> <a href="/tags/this/" style="font-size: 10px">this</a> <a href="/tags/ui-router/" style="font-size: 14.17px">ui-router</a></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-content"><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/01/18/debouncing-throttling-explained-examples/">实例解析防抖和节流函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/quick-tip-multiple-versions-node-nvm/">使用 nvm 管理不同版本的 node 与 npm</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/15-ways-to-write-self-documenting-javascript/">如何编写更加自解释的代码</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/31/high-performance-animations/">使用 FLIP 来提高 Web 动画的性能</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/28/styling-broken-images/">定制图片加载失败时的样式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/26/delivering-octicons-with-svg/">使用 SVG 输出 Octicon</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/18/how-to-use-npm-as-a-build-tool/">如何将 npm 作为构建工具使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/24/what-you-can-do-with-gists-on-github/">任何人都可以使用到的 Gist 服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/19/prefetching-preloading-prebrowsing/">前端性能优化 - 资源预加载</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/18/es6-in-depth-the-future/">深入解析 ES6：未来展望</a></li></ul></div></div></aside><aside id="topic-wrap" class="toc-wrap f-right"><h3 class="toc-wrap-title">内容</h3><div class="toc-tree"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#我是谁以及我为什么要撰写这个主题"><span class="toc-number">1.</span> <span class="toc-text">我是谁以及我为什么要撰写这个主题？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#140-个字的全文概述"><span class="toc-number">2.</span> <span class="toc-text">140 个字的全文概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是大型-javascript-应用"><span class="toc-number">3.</span> <span class="toc-text">什么是“大型” JavaScript 应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#回顾一下你目前的架构"><span class="toc-number">4.</span> <span class="toc-text">回顾一下你目前的架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#从长远考虑"><span class="toc-number">5.</span> <span class="toc-text">从长远考虑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#头脑风暴"><span class="toc-number">6.</span> <span class="toc-text">头脑风暴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#推荐架构"><span class="toc-number">7.</span> <span class="toc-text">推荐架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#模块化理论"><span class="toc-number">7.1.</span> <span class="toc-text">模块化理论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模块模式-the-module-pattern"><span class="toc-number">7.2.</span> <span class="toc-text">模块模式 The Module Pattern</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dojo"><span class="toc-number">7.2.1.</span> <span class="toc-text">Dojo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#yui"><span class="toc-number">7.2.2.</span> <span class="toc-text">YUI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jquery"><span class="toc-number">7.2.3.</span> <span class="toc-text">jQuery</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对象字面量-object-literal-notation"><span class="toc-number">7.3.</span> <span class="toc-text">对象字面量 Object Literal Notation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commonjs-模块-commonjs-modules"><span class="toc-number">7.4.</span> <span class="toc-text">CommonJS 模块 CommonJS Modules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#外观模式-the-facade-pattern"><span class="toc-number">7.5.</span> <span class="toc-text">外观模式 The Facade Pattern</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#中介模式-the-mediator-pattern"><span class="toc-number">7.6.</span> <span class="toc-text">中介模式 The Mediator Pattern</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用外观模式-抽象的核心"><span class="toc-number">7.7.</span> <span class="toc-text">应用外观模式 - 抽象的核心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用中介者模式-应用程序核心"><span class="toc-number">7.8.</span> <span class="toc-text">应用中介者模式 - 应用程序核心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#集成应用-tying-it-all-together"><span class="toc-number">7.9.</span> <span class="toc-text">集成应用 Tying It All Together</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#超越beyond发布订阅自动事件注册"><span class="toc-number">8.</span> <span class="toc-text">超越(Beyond)发布/订阅：自动事件注册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常问问题"><span class="toc-number">9.</span> <span class="toc-text">常问问题</span></a></li></ol></div><div class="toc-progress"></div></aside></div><footer id="footer" class="inner"><span class="copyright">© 2017 bubkoo</span><span class="theme">@<a href="https://github.com/bubkoo/hexo-theme-formula" target="_blank">formula</a></span></footer><img id="go2top" src="/images/top_arrow.png" alt="go2top"><script charset="utf-8" src="/js/lib/jquery-2.1.3.min.js"></script><script charset="utf-8" src="/js/lib/jquery.imagesloaded.min.js"></script><script charset="utf-8" src="/fancybox/jquery.fancybox.pack.js"></script><script charset="utf-8" src="/js/lib/sea.js"></script><script charset="utf-8" src="/js/main.js"></script><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment = new Gitment({
    owner: 'bubkoo',
    repo: 'bubkoo.github.com',
    oauth: {
        client_id: '13c9fa4a27f96e5296bf',
        client_secret: 'd0f07fcf8605a22de1e57fd96ddb0666d2ce0751',
    },
})
gitment.render('article-comment')</script></body></html>