<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><title>使用 Developer Tools 进行 JavaScript 性能分析 | bubkoo</title><meta name="author" content="bubkoo"><meta name="description" content="原文链接：JavaScript Profiling With The Chrome Developer Tools
现在，让我们来让你的网站跑得更快，网站性能通常包括两个方面：页面加载速度和脚本执行速度，有很多方法可以让网站加载更快，例如，压缩文件和 CND 等，但是要让脚本执行更快就得靠开发人员自己了。
代码很小的改动就可能对性能产生巨大影响，不同位置的几行代码可能就意味着一个快的网站和产生可怕的“无响应脚本”对话框的网站之间的区别。本文展示了使用 Chrome 开发工具来找到这些性能关键点代码的一些方法。
建立基准线我们来看一个简单的颜色排序应用，这个应用展示了一个由各种颜色构成的网格，您可以拖放任意一个颜色点来混淆。每一个颜色点都是一个 div 标签，使用了一些 CSS 来让它们看起来像一个圆点。

点击这里访问该应用。
生成一个这些颜色有点棘手，所以我参考了 Making Annoying Rainbows in JavaScript 这篇文章。"><meta name="viewport" content="width=device-width,initial-scale=1"><meta property="og:title" content="使用 Developer Tools 进行 JavaScript 性能分析"><meta property="og:site_name" content="bubkoo"><link href="/favicon.ico" rel="icon" type="image/x-ico"><link href="/atom.xml" rel="alternate" title="bubkoo" type="application/atom+xml"><link href="/css/style.css" rel="stylesheet" type="text/css" charset="utf-8"><link href="/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" charset="utf-8"><script id="google_analytics">(function (window, document, src, ga) {

  window['GoogleAnalyticsObject'] = ga;

  if (!window[ga]) {
    window[ga] = function () {
      (window[ga].q = window[ga].q || []).push(arguments);
    };
  }

  window[ga].l = 1 * new Date();

  var thisTag = document.getElementById('google_analytics');
  var script  = document.createElement('script');

  script.async = true;
  script.src   = src;

  thisTag.parentNode.insertBefore(script, thisTag);

  setTimeout(function () {
    script.parentNode.removeChild(script);
    thisTag.parentNode.removeChild(thisTag);
  }, 100);

})(window, document, 'https://www.google-analytics.com/analytics.js', 'ga');

ga('create', 'UA-78428859-2', 'auto');
ga('send', 'pageview');</script><script id="baidu_tongji">var _hmt = _hmt || [];
(function () {
  var script  = document.createElement('script');
  var thisTag = document.getElementById('baidu_tongji');

  script.src = '//hm.baidu.com/hm.js?49a1665c33b011585a2a629fdbed5b61';

  thisTag.parentNode.insertBefore(script, thisTag);

  setTimeout(function () {
    script.parentNode.removeChild(script);
    thisTag.parentNode.removeChild(thisTag);
  }, 100);
})();</script><!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]--><script>__start__ = window.performance && performance.timing ? performance.timing.navigationStart : Date.now();</script></head><body><header id="header" hoot="default" hoot-rate="1" class="inner"><div class="f-left"><a href="/" class="site-title">bubkoo</a></div><nav class="f-right"><ul class="site-nav"><li><a href="/">&lt;&gt;</a></li><li><a href="/archives">Archives</a></li><li><a href="https://github.com/bubkoo">Github</a></li></ul></nav></header><div id="container" class="inner"><div id="main"><article class="article post"><div class="article-wrap"><header class="article-header"><span class="article-header-icon icon-black"></span><h1 class="article-header-title">使用 Developer Tools 进行 JavaScript 性能分析</h1><time datetime="2014-02-19T01:13:32.000Z" itemprop="datePublished" class="article-header-time"><span class="day">19</span><span class="month">2014年02月</span></time></header><section class="article-content"><p>原文链接：<a href="http://coding.smashingmagazine.com/2012/06/12/javascript-profiling-chrome-developer-tools/" target="_blank" rel="external">JavaScript Profiling With The Chrome Developer Tools</a></p>
<p>现在，让我们来让你的网站跑得更快，网站性能通常包括两个方面：页面加载速度和脚本执行速度，有很多方法可以让网站加载更快，例如，压缩文件和 CND 等，但是要让脚本执行更快就得靠开发人员自己了。</p>
<p>代码很小的改动就可能对性能产生巨大影响，不同位置的几行代码可能就意味着一个快的网站和产生可怕的“无响应脚本”对话框的网站之间的区别。本文展示了使用 Chrome 开发工具来找到这些性能关键点代码的一些方法。</p>
<h2><span id="建立基准线">建立基准线</span></h2><p>我们来看一个简单的<a href="http://zgrossbart.github.io/jsprofarticle/index1.htm" target="_blank" rel="external">颜色排序应用</a>，这个应用展示了一个由各种颜色构成的网格，您可以拖放任意一个颜色点来混淆。每一个颜色点都是一个 div 标签，使用了一些 CSS 来让它们看起来像一个圆点。</p>
<p><img src="http://bubkoo.qiniudn.com/color%20sorter.png" alt="Color Sorter"></p>
<p><a href="http://zgrossbart.github.io/jsprofarticle/index1.htm" target="_blank" rel="external">点击这里</a>访问该应用。</p>
<p>生成一个这些颜色有点棘手，所以我参考了 <a href="http://krazydad.com/tutorials/makecolors.php" target="_blank" rel="external">Making Annoying Rainbows in JavaScript</a> 这篇文章。</p>
<a id="more"></a>
<p>这个页面载入很快，但是仍需要一些时间，是时候来优化它使其运行更快了。</p>
<p>在开始对一个网站进行性能优化之前，我们需要设置一个基准线，从而得知优化效果怎么样，并帮助我们权衡利弊。在本文中，我们将使用 <a href="http://code.google.com/chrome/devtools/docs/overview.html" target="_blank" rel="external">Chrome 开发者工具</a>。</p>
<p>性能分析器（profiler）是 Chrome 开发者工具的一部分，通过点击“工具”菜单下的小扳手来打开它。<a href="http://getfirebug.com/" target="_blank" rel="external">Firebug</a> 也有性能分析工具，但是，WebKit 内核的浏览器（Chrome 和 Safari）在代码分析和展示时间线方面是最好的。Chrome 还提供了一个很棒的事件跟踪工具，叫 <a href="https://developers.google.com/web-toolkit/speedtracer/" target="_blank" rel="external">Speed Tracer</a>。</p>
<p>为了建立我们的基线，首先在“Timeline”选项卡中点击“Record”开始记录，加载页面，然后停止记录，Chrome 非常智能，只有当开始加载页面的时候才开始记录。这里记录了三次，然后取三次的平均值，以防在第一次测试时我的电脑运行的很慢。</p>
<p><img src="http://bubkoo.qiniudn.com/Developer%20Tools&#39;%20baseline-1.png" alt=""></p>
<p>我的平均基线，也就是从第一次请求页面到页面渲染完成所花费的时间是 1.25 秒，这个并不算慢，但是对于这样的小型应用还不够好。</p>
<p>我想让我的代码运行的更快，但是我还不知道是哪里导致代码运行缓慢的。性能分析工具（profiler）将帮助我找到原因。</p>
<h2><span id="创建一个-profile">创建一个 Profile</span></h2><p>通过时间线（timeline）我们知道代码运行了多久，但是我们并不知道代码在运行时具体发生了什么。虽然可以通过修改代码后，再次记录时间线，然后重复这个过程，来找到影响性能的代码，但这太盲目了，很难找到性能瓶颈点。“Profiles”选项卡给我们提供了一个更好的方式，去了解代码的具体执行情况。</p>
<p>“Profiles”选项卡直观地显示了哪个函数占用了大部分执行时间，在Chrome 开发者工具的“Profiles”选项卡中，提供了三种性能分析方式：</p>
<ol>
<li>JavaScript CPU profile，显示我们的 JavaScript 运行时占用了多少 CPU 时间。</li>
<li>CSS selector profile，显示处理 CSS 选择器时占用了多少 CPU 时间。</li>
<li>Heap snapshot，显示 JavaScript 对象的内存占用情况。</li>
</ol>
<p>我们想让代码执行更快，所以我们将使用 CPU 性能测试。点击开始分析，刷新页面，加载完成之后停止分析器。</p>
<p><img src="http://bubkoo.qiniudn.com/Developer%20Tools&#39;%20baseline-2.png" alt=""></p>
<p>从分析结果知道页面上有很多函数在执行。在这个应用中使用了 jQuery 和 jQuery UI 来管理插件和解析正则表达式等工作。同时，我们可以看到我们的这两个函数：<code>decimalToHex</code> 和 <code>makeColorSorter</code> 位居列表的顶部，这两个函数总共占用了 13.2% 的执行时间，所以他们是很好的性能优化点。</p>
<p>在分析工具中，我们可以点击函数名称左边的小箭头来展开函数的调用堆栈，可以看出，<code>decimalToHex</code> 被 <code>makeColorSorter</code> 调用，<code>makeColorSorter</code> 又被 <code>$(document).ready</code> 调用。</p>
<p>代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    makeColorSorter(<span class="number">.05</span>, <span class="number">.05</span>, <span class="number">.05</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">128</span>, <span class="number">127</span>, <span class="number">121</span>);</div><div class="line">    makeSortable();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>从调用来源可以知道 <code>makeSortable</code> 方法并不是我们最大的性能问题。通常情况下排序操作会带来一些<a href="http://37signals.com/svn/posts/3137-using-event-capturing-to-improve-basecamp-page-load-times" target="_blank" rel="external">性能问题</a>，但是，在我们的代码中添加 DOM 元素花费了比排序还要多的时间。</p>
<p>在开始优化之前，我们首先需要孤立将要优化的代码，页面加载的时候执行的函数太多了，我不想这些影响到我们的性能分析。</p>
<h2><span id="隔离代码">隔离代码</span></h2><p>我编写了<a href="http://zgrossbart.github.com/jsprofarticle/index2.htm" target="_blank" rel="external">第二个版本</a>的颜色排序应用，在这个版本中，页面载入的时候并不会执行我们的应用，直到我们点击页面上的一个按钮时，才执行我们的应用。这样就让我们的代码从页面加载过程中隔离出来，当我们优化完成之后再修改回去。</p>
<p>将隔离出来的代码放在一个新函数中，命名为 <code>testColorSorter</code> ，然后将其绑定在按钮上：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">testColorSorter</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    makeColorSorter(<span class="number">.05</span>, <span class="number">.05</span>, <span class="number">.05</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">128</span>, <span class="number">127</span>, <span class="number">121</span>);</div><div class="line">    makeSortable();</div><div class="line">&#125;</div><div class="line"></div><div class="line">&lt;button id=<span class="string">"clickMe"</span> onclick=<span class="string">"testColorSorter();"</span>&gt;Click me&lt;<span class="regexp">/button&gt;</span></div></pre></td></tr></table></figure>
<p>在我们进行性能分析之前修改代码可能会导致意外的结果。虽然这个改动看起来很安全，但是我还是要重新运行性能分析，来看看我是不是无意中改变了什么。我会开始一次新的性能分析，点击应用中的按钮，等应用加载完成后，点击停止。</p>
<p><img src="http://bubkoo.qiniudn.com/Developer%20Tools&#39;%20baseline-3.png" alt=""></p>
<p>现在 <code>decimalToHex</code> 函数的载入只占用了 4.23% 的时间，这是代码执行花费时间最多的地方。我们需要创建一个新的基线来看看这个方案将会有多大优化。</p>
<p><img src="http://bubkoo.qiniudn.com/Developer%20Tools&#39;%20baseline-4.png" alt=""></p>
<p>在点击按钮之前有一些事件被触发了，但是我只关心从我点击按钮到浏览器渲染完成“颜色排序器”所花费的时间。鼠标在 390 毫秒的时间点击，渲染事件在 726 毫秒时被触发。726 减去 390 就得到基线值 336 毫秒。同样，我重复了三次，然后取平均值。</p>
<p>此时，我知道在哪里看代码的运行时间了，现在我们可以开始解决性能问题。</p>
<h2><span id="优化代码">优化代码</span></h2><p>通过性能分析器我们只知道是哪个函数有性能问题，我们还需要查看函数的内部实现，来了解函数具体做了什么。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">decimalToHex</span>(<span class="params">d</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> hex = <span class="built_in">Number</span>(d).toString(<span class="number">16</span>);</div><div class="line">    hex = <span class="string">"00"</span>.substr(<span class="number">0</span>, <span class="number">2</span> - hex.length) + hex; </div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'converting '</span> + d + <span class="string">' to '</span> + hex);</div><div class="line">    <span class="keyword">return</span> hex;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>“颜色排序器”中的每一个颜色点都有一个 <a href="http://en.wikipedia.org/wiki/Hexadecimal" target="_blank" rel="external">16 进制</a>的颜色值，例如 <code>#86F01B</code> 和 <code>#2345FE</code>，这些值分别表示了颜色中红、绿、蓝三原色各自的值。例如背景色是 <code>#2456FE</code> 的颜色点，就代表红色的值是 36，绿色的值是 86，蓝色的是 254，每一个数值必须在 0 到 255 之间。</p>
<p><code>decimalToHex</code> 函数就是把这用 RGB 值表示的颜色转化为页面中我们使用的十六进制颜色。</p>
<p>这个函数非常简单，但是我还是留下了一个可以去掉的调试代码 <code>console.log</code> 在那里。</p>
<p>由于某些十进制数字对应的十六进制数字只有一位，例如十进制的 10 表示为十六进制后是 C，而三原色中的颜色值需要两位十六进制的数字，所以有必要在 <code>decimalToHex</code> 函数中进行补位。为了让这个转换函数执行更加快，我们可以修改里面的补位操作，使其并不那么泛化。由于我们知道需要补位的数字的长度都为 1，所以我们可以这样重构这个函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">decimalToHex</span>(<span class="params">d</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> hex = <span class="built_in">Number</span>(d).toString(<span class="number">16</span>);</div><div class="line">    <span class="keyword">return</span> hex.length === <span class="number">1</span> ? <span class="string">'0'</span> + hex : hex; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在<a href="http://zgrossbart.github.com/jsprofarticle/index3.htm" target="_blank" rel="external">第三个版本</a>的颜色排序器中，只有在需要补位的时候才会修改字符串，并且不用调用 <code>substr</code> 函数。有了这个新函数，我们的运行时间是 137 毫秒，再次对代码进行性能测试，可以发现 <code>decimalToHex</code> 函数只占用了总时间的 0.04%，到了性能列表的下部。</p>
<p><img src="http://bubkoo.qiniudn.com/Developer%20Tools&#39;%20baseline-5..png" alt=""></p>
<p>我们还可以发现占用 CPU 时间最多的函数是 jQuery 的 <code>e.extend.merge</code>。我并不知道这个函数的作用，因为 jQuery 代码是被压缩过的。我们可以使用开发版本的 jQuery，但是我发现这个函数是被 <code>makeColorSorter</code> 调用的。所以下一步我们先让这个函数执行的更快。</p>
<h2><span id="减小内容改动">减小内容改动</span></h2><p>“颜色排序器”中的颜色是用过正弦曲线生成的。在光谱中设置一个中心点，然后以一定的偏移来创建这个曲线，这就把颜色变成了一个“彩虹模型”。我们还可以通过改变红、绿、蓝三原色的频率来改变颜色。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeColorSorter</span>(<span class="params">frequency1, frequency2, frequency3,</span></span></div><div class="line"><span class="function"><span class="params">                         phase1, phase2, phase3,</span></span></div><div class="line"><span class="function"><span class="params">                         center, width, len</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; ++i)</div><div class="line">    &#123;</div><div class="line">       <span class="keyword">var</span> red = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.sin(frequency1 * i + phase1) * width + center);</div><div class="line">       <span class="keyword">var</span> green = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.sin(frequency2 * i + phase2) * width + center);</div><div class="line">       <span class="keyword">var</span> blue = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.sin(frequency3 * i + phase3) * width + center);</div><div class="line"></div><div class="line">       <span class="built_in">console</span>.log(<span class="string">'red: '</span> + decimalToHex(red));</div><div class="line">       <span class="built_in">console</span>.log(<span class="string">'green: '</span> + decimalToHex(green));</div><div class="line">       <span class="built_in">console</span>.log(<span class="string">'blue: '</span> + decimalToHex(blue));</div><div class="line"></div><div class="line">       <span class="keyword">var</span> div = $(<span class="string">'&lt;div class="colorBlock"&gt;&lt;/div&gt;'</span>);</div><div class="line">       div.css(<span class="string">'background-color'</span>, <span class="string">'#'</span> + decimalToHex(red) + decimalToHex(green) + decimalToHex(blue));</div><div class="line">       $(<span class="string">'#colors'</span>).append(div);</div><div class="line">       </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们应该去掉 <code>console.log</code> 函数。这样调用非常糟糕，因为每次执行都会调用 <code>decimalToHex</code> 函数，这意味着 <code>decimalToHex</code> 的调用次数将会增加一倍。</p>
<p>这个函数还会频繁地修改 DOM 结构。每次循环，都向 ID 为 <code>colors</code> 的 <code>div</code> 中添加一个新的 <code>div</code>。这就让我怀疑这可能就是 <code>e.extend.merge</code> 函数所做的事情。用性能分析器做一个小实验就可以搞清楚。</p>
<p>我想要在循环结束后一次性把所有的 <code>div</code> 添加进去，而不是在每个循环中添加都一个新的 <code>div</code>，我们需要在循环外创建一个变量来存储这些 <code>div</code>，然后在最后一次性添加进去。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeColorSorter</span>(<span class="params">frequency1, frequency2, frequency3,</span></span></div><div class="line"><span class="function"><span class="params">                         phase1, phase2, phase3,</span></span></div><div class="line"><span class="function"><span class="params">                         center, width, len</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> colors = <span class="string">""</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; ++i)</div><div class="line">    &#123;</div><div class="line">       <span class="keyword">var</span> red = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.sin(frequency1 * i + phase1) * width + center);</div><div class="line">       <span class="keyword">var</span> green = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.sin(frequency2 * i + phase2) * width + center);</div><div class="line">       <span class="keyword">var</span> blue = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.sin(frequency3 * i + phase3) * width + center);</div><div class="line"></div><div class="line">       colors += <span class="string">'&lt;div class="colorBlock" style="background-color: #'</span> + </div><div class="line">           decimalToHex(red) + decimalToHex(green) + decimalToHex(blue) + <span class="string">'"&gt;&lt;/div&gt;'</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $(<span class="string">'#colors'</span>).append(colors);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个微小改动意味着在添加所有这些 <code>div</code> 的时候，只有一次 DOM 操作。用时间线进行测试，我们发现从点击到渲染只用了 31 毫秒。这个一次性的 DOM 操作，使得<a href="http://zgrossbart.github.com/jsprofarticle/index4.htm" target="_blank" rel="external">第四个版本</a>的运行时间降低了 86%。我可以再次打开性能分析器(profiler)，发现 <code>e.extend.merge</code> 函数占用了仅很少的时间，在性能列表中已经看不到它了。</p>
<p>我们还可以移除 <code>decimalToHex</code> 函数让代码更快一点。因为 <a href="http://www.w3schools.com/cssref/css_colors.asp" target="_blank" rel="external">CSS 支持 RGB 颜色值</a>，所以我们不需要把他们转换到十六进制。现在我们可以这样修改 <code>makeColorSorter</code> 函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeColorSorter</span>(<span class="params">frequency1, frequency2, frequency3,</span></span></div><div class="line"><span class="function"><span class="params">                         phase1, phase2, phase3,</span></span></div><div class="line"><span class="function"><span class="params">                         center, width, len</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> colors = <span class="string">""</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; ++i)</div><div class="line">    &#123;</div><div class="line">       <span class="keyword">var</span> red = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.sin(frequency1 * i + phase1) * width + center);</div><div class="line">       <span class="keyword">var</span> green = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.sin(frequency2 * i + phase2) * width + center);</div><div class="line">       <span class="keyword">var</span> blue = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.sin(frequency3 * i + phase3) * width + center);</div><div class="line"></div><div class="line">       colors += <span class="string">'&lt;div class="colorBlock" style="background-color: rgb('</span> + </div><div class="line">           red + <span class="string">','</span> + green + <span class="string">','</span> + blue + <span class="string">')"&gt;&lt;/div&gt;'</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $(<span class="string">'#colors'</span>).append(colors);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="http://zgrossbart.github.com/jsprofarticle/index5.htm" target="_blank" rel="external">第五个版本</a>的执行只用了 26 毫秒，而且代码也从 28 行减少到 18 行。</p>
<h2><span id="在你的应用中进行-javascript-性能分析">在你的应用中进行 Javascript 性能分析</span></h2><p>现实环境中的应用要不这里的“颜色排序器”要复杂得多，但是做性能分析都遵循相同的基本步骤：</p>
<ol>
<li><strong>建立基准线</strong>，这样你就知道从何开始</li>
<li><strong>隔离代码</strong>，将可能有性能问题的代码与其他代码隔离开来</li>
<li><strong>优化代码</strong>，频繁的使用时间线（timelines）和性能分析器（profiles），在可控的条件下进行逐步优化</li>
</ol>
<p>还有一些性能优化的准则：</p>
<ol>
<li><strong>从最慢的部分开始</strong>，这样在时间优化上可以得到最大的提升</li>
<li><strong>保持环境统一</strong>，如果你换了电脑或者做了任何大的改动，都要设置新的基线</li>
<li><strong>多次分析</strong>以防电脑的异常而影响了结果的准确性</li>
</ol>
<p>每个人都想要自己的网站更快，同时还必须开发新的功能，但是新的功能通常会让网站更慢。所以花费时间来做性能优化是有价值的。</p>
<p>性能分析和优化使得<a href="http://zgrossbart.github.com/jsprofarticle/index6.htm" target="_blank" rel="external">最终版</a>的“颜色分类器”的执行时间减少了 92%。你的网站可以变快多少？</p>
<p>英文原文：<a href="http://coding.smashingmagazine.com/2012/06/12/javascript-profiling-chrome-developer-tools/" target="_blank" rel="external">Zack Grossbart</a>，翻译：<a href="http://bubkoo.com/">布谷 bubkoo</a></p>
<p>原文链接：<a href="http://coding.smashingmagazine.com/2012/06/12/javascript-profiling-chrome-developer-tools/" target="_blank" rel="external">JavaScript Profiling With The Chrome Developer Tools</a></p></section><footer class="article-footer clearfix"><div class="tags"><a href="/tags/performance/" title="Performance">Performance</a></div></footer></div><nav class="article-nav clearfix"><a href="/2014/02/22/JSHint-options/" class="article-nav-link article-nav-newer"><strong class="article-nav-type">Newer</strong><span class="article-nav-title">JSHint 选项列表</span></a><a href="/2014/02/18/bulletproof-javascript-benchmarks/" class="article-nav-link article-nav-older"><strong class="article-nav-type">Older</strong><span class="article-nav-title">【译】Javascript 基准测试</span></a></nav></article><section id="article-comment" class="article-comment"></section><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><style>.gitment-root-container{
  margin: 40px 0;
}
.gitment-container {
  font-size: 12px;
}
.gitment-comment-main, .gitment-editor-main{
  background-color: #fff;
}
.gitment-footer-container{
  color: #999;
}
.gitment-comment-main,
.gitment-editor-main{
  background: #fff;
}
a.gitment-footer-project-link,
a.gitment-footer-project-link:visited,
a.gitment-editor-login-link,
a.gitment-editor-login-link:visited {
  color: #1ba1e2;
  opacity: .3;
  -webkit-transition: opacity 0.4s;
  -moz-transition: opacity 0.4s;
  -o-transition: opacity 0.4s;
  -ms-transition: opacity 0.4s;
  transition: opacity 0.4s;
}
a.gitment-footer-project-link:hover,
a.gitment-editor-login-link:hover{
  opacity: 1;
  -webkit-transition: opacity 0.4s;
  -moz-transition: opacity 0.4s;
  -o-transition: opacity 0.4s;
  -ms-transition: opacity 0.4s;
  transition: opacity 0.4s;
}</style><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var options = {
  owner: 'bubkoo',
  repo:  'bubkoo.github.com',
  oauth: {
    client_id: '13c9fa4a27f96e5296bf',
    client_secret: 'd0f07fcf8605a22de1e57fd96ddb0666d2ce0751',
  }
};
var gitment = new Gitment(options);
gitment.render('article-comment')</script></div><aside id="sidebar" role="sidebar"><div class="widget tagcloud"><h3 class="widget-title">标签</h3><div class="widget-content"><a href="/tags/aop/" style="font-size: 10px">AOP</a> <a href="/tags/algorithm/" style="font-size: 18.33px">Algorithm</a> <a href="/tags/analysis/" style="font-size: 10px">Analysis</a> <a href="/tags/angularjs/" style="font-size: 15px">AngularJS</a> <a href="/tags/animation/" style="font-size: 10px">Animation</a> <a href="/tags/architecture/" style="font-size: 16.67px">Architecture</a> <a href="/tags/archives/" style="font-size: 10.83px">Archives</a> <a href="/tags/async/" style="font-size: 12.5px">Async</a> <a href="/tags/backbone/" style="font-size: 10px">Backbone</a> <a href="/tags/browsers/" style="font-size: 10px">Browsers</a> <a href="/tags/css/" style="font-size: 12.5px">CSS</a> <a href="/tags/css3/" style="font-size: 10px">CSS3</a> <a href="/tags/closure/" style="font-size: 10.83px">Closure</a> <a href="/tags/closures/" style="font-size: 10px">Closures</a> <a href="/tags/cookies/" style="font-size: 10px">Cookies</a> <a href="/tags/cross-domain/" style="font-size: 10px">Cross Domain</a> <a href="/tags/custom-elements/" style="font-size: 10.83px">Custom Elements</a> <a href="/tags/d3/" style="font-size: 10px">D3</a> <a href="/tags/debounce/" style="font-size: 10px">Debounce</a> <a href="/tags/debug/" style="font-size: 10.83px">Debug</a> <a href="/tags/dependency/" style="font-size: 10px">Dependency</a> <a href="/tags/document/" style="font-size: 10px">Document</a> <a href="/tags/ecma-262-3/" style="font-size: 15.83px">ECMA-262-3</a> <a href="/tags/ecmascript/" style="font-size: 15.83px">ECMAScript</a> <a href="/tags/es6/" style="font-size: 20px">ES6</a> <a href="/tags/errors/" style="font-size: 10px">Errors</a> <a href="/tags/essential/" style="font-size: 10px">Essential</a> <a href="/tags/evaluation-strategy/" style="font-size: 10px">Evaluation strategy</a> <a href="/tags/event/" style="font-size: 10px">Event</a> <a href="/tags/exceptions/" style="font-size: 10px">Exceptions</a> <a href="/tags/express/" style="font-size: 10px">Express</a> <a href="/tags/flip/" style="font-size: 10px">FLIP</a> <a href="/tags/flexbox/" style="font-size: 10px">Flexbox</a> <a href="/tags/framework/" style="font-size: 10px">Framework</a> <a href="/tags/funarg/" style="font-size: 10px">Funarg</a> <a href="/tags/gist/" style="font-size: 10px">Gist</a> <a href="/tags/github/" style="font-size: 10px">Github</a> <a href="/tags/guide/" style="font-size: 10px">Guide</a> <a href="/tags/html/" style="font-size: 10px">HTML</a> <a href="/tags/http/" style="font-size: 10px">HTTP</a> <a href="/tags/hexo/" style="font-size: 10.83px">Hexo</a> <a href="/tags/ie/" style="font-size: 10px">IE</a> <a href="/tags/iife/" style="font-size: 10px">IIFE</a> <a href="/tags/jshint/" style="font-size: 10px">JSHint</a> <a href="/tags/javascript/" style="font-size: 19.17px">JavaScript</a> <a href="/tags/leak/" style="font-size: 10px">Leak</a> <a href="/tags/linting/" style="font-size: 10px">Linting</a> <a href="/tags/mvc/" style="font-size: 10px">MVC</a> <a href="/tags/methodology/" style="font-size: 10px">Methodology</a> <a href="/tags/mickey/" style="font-size: 10px">Mickey</a> <a href="/tags/mock/" style="font-size: 10px">Mock</a> <a href="/tags/modular/" style="font-size: 10px">Modular</a> <a href="/tags/mongodb/" style="font-size: 10px">MongoDB</a> <a href="/tags/oop/" style="font-size: 10.83px">OOP</a> <a href="/tags/partial-application/" style="font-size: 10px">Partial Application</a> <a href="/tags/pattern/" style="font-size: 10px">Pattern</a> <a href="/tags/patterns/" style="font-size: 10px">Patterns</a> <a href="/tags/performance/" style="font-size: 14.17px">Performance</a> <a href="/tags/promise/" style="font-size: 13.33px">Promise</a> <a href="/tags/prototype/" style="font-size: 11.67px">Prototype</a> <a href="/tags/quality/" style="font-size: 10px">Quality</a> <a href="/tags/quiz/" style="font-size: 10px">Quiz</a> <a href="/tags/react/" style="font-size: 10px">React</a> <a href="/tags/regex/" style="font-size: 10px">Regex</a> <a href="/tags/requirejs/" style="font-size: 10px">RequireJS</a> <a href="/tags/sass/" style="font-size: 10px">SASS</a> <a href="/tags/svg/" style="font-size: 10px">SVG</a> <a href="/tags/scope/" style="font-size: 10.83px">Scope</a> <a href="/tags/shapes/" style="font-size: 10px">Shapes</a> <a href="/tags/shuffle/" style="font-size: 10px">Shuffle</a> <a href="/tags/sort/" style="font-size: 17.5px">Sort</a> <a href="/tags/source-map/" style="font-size: 10.83px">Source Map</a> <a href="/tags/styling/" style="font-size: 10px">Styling</a> <a href="/tags/sublime-text/" style="font-size: 10px">Sublime Text</a> <a href="/tags/template/" style="font-size: 10px">Template</a> <a href="/tags/throttle/" style="font-size: 10px">Throttle</a> <a href="/tags/timing/" style="font-size: 10px">Timing</a> <a href="/tags/tools/" style="font-size: 12.5px">Tools</a> <a href="/tags/variable-object/" style="font-size: 10px">Variable object</a> <a href="/tags/visualizations/" style="font-size: 10px">Visualizations</a> <a href="/tags/when/" style="font-size: 12.5px">When</a> <a href="/tags/delete/" style="font-size: 10px">delete</a> <a href="/tags/execution-context/" style="font-size: 10px">execution context</a> <a href="/tags/fetch/" style="font-size: 10px">fetch</a> <a href="/tags/function/" style="font-size: 10px">function</a> <a href="/tags/nodejs/" style="font-size: 10px">nodejs</a> <a href="/tags/nodemon/" style="font-size: 10px">nodemon</a> <a href="/tags/npm/" style="font-size: 10px">npm</a> <a href="/tags/nvm/" style="font-size: 10px">nvm</a> <a href="/tags/performance/" style="font-size: 10px">performance</a> <a href="/tags/prebrowsing/" style="font-size: 10px">prebrowsing</a> <a href="/tags/prefetching/" style="font-size: 10px">prefetching</a> <a href="/tags/preloading/" style="font-size: 10px">preloading</a> <a href="/tags/tabindex/" style="font-size: 10px">tabindex</a> <a href="/tags/this/" style="font-size: 10px">this</a> <a href="/tags/ui-router/" style="font-size: 14.17px">ui-router</a></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-content"><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/21/react-framework-mickey/">React 框架新轮子：Mickey</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/18/debouncing-throttling-explained-examples/">实例解析防抖和节流函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/quick-tip-multiple-versions-node-nvm/">使用 nvm 管理不同版本的 node 与 npm</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/15-ways-to-write-self-documenting-javascript/">如何编写更加自解释的代码</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/31/high-performance-animations/">使用 FLIP 来提高 Web 动画的性能</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/28/styling-broken-images/">定制图片加载失败时的样式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/26/delivering-octicons-with-svg/">使用 SVG 输出 Octicon</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/18/how-to-use-npm-as-a-build-tool/">如何将 npm 作为构建工具使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/24/what-you-can-do-with-gists-on-github/">任何人都可以使用到的 Gist 服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/19/prefetching-preloading-prebrowsing/">前端性能优化 - 资源预加载</a></li></ul></div></div></aside><aside id="topic-wrap" class="toc-wrap f-right"><h3 class="toc-wrap-title">内容</h3><div class="toc-tree"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">建立基准线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">创建一个 Profile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">隔离代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">优化代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">5.</span> <span class="toc-text">减小内容改动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">6.</span> <span class="toc-text">在你的应用中进行 Javascript 性能分析</span></a></li></ol></div><div class="toc-progress"></div></aside></div><footer id="footer" class="inner"><span class="copyright">© 2017 bubkoo</span><span class="theme">@<a href="https://github.com/bubkoo/hexo-theme-formula" target="_blank">formula</a></span></footer><img id="go2top" src="/images/top_arrow.png" alt="go2top"><script charset="utf-8" src="/js/lib/jquery-2.1.3.min.js"></script><script charset="utf-8" src="/js/lib/jquery.imagesloaded.min.js"></script><script charset="utf-8" src="/fancybox/jquery.fancybox.pack.js"></script><script charset="utf-8" src="/js/lib/sea.js"></script><script charset="utf-8" src="/js/main.js"></script></body></html>