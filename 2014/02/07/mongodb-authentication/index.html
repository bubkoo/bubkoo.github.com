<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><title>MongoDB 用户和身份验证 | bubkoo</title><meta name="author" content="bubkoo"><meta name="description" content="MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。这里推荐一个快速入门教程 - 8天学通 MongoDB，写的很全面。这里讨论的是 MongoDB 的用户和身份验证。
在默认情况下，MongoDB 不会进行身份验证，也没有账号，只要能连接上服务就可以对数据库进行各种操作，如果你在一个面向公众的服务器上使用它，那么这的确是一个问题。"><meta name="viewport" content="width=device-width,initial-scale=1"><meta property="og:title" content="MongoDB 用户和身份验证"><meta property="og:site_name" content="bubkoo"><link href="/favicon.ico" rel="icon" type="image/x-ico"><link href="/atom.xml" rel="alternate" title="bubkoo" type="application/atom+xml"><link href="/css/style.css" rel="stylesheet" type="text/css" charset="utf-8"><link href="/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" charset="utf-8"><script id="google_analytics">(function (window, document, src, ga) {

  window['GoogleAnalyticsObject'] = ga;

  if (!window[ga]) {
    window[ga] = function () {
      (window[ga].q = window[ga].q || []).push(arguments);
    };
  }

  window[ga].l = 1 * new Date();

  var thisTag = document.getElementById('google_analytics');
  var script  = document.createElement('script');

  script.async = true;
  script.src   = src;

  thisTag.parentNode.insertBefore(script, thisTag);

  setTimeout(function () {
    script.parentNode.removeChild(script);
    thisTag.parentNode.removeChild(thisTag);
  }, 100);

})(window, document, 'https://www.google-analytics.com/analytics.js', 'ga');

ga('create', 'UA-78428859-2', 'auto');
ga('send', 'pageview');</script><script id="baidu_tongji">var _hmt = _hmt || [];
(function () {
  var script  = document.createElement('script');
  var thisTag = document.getElementById('baidu_tongji');

  script.src = '//hm.baidu.com/hm.js?49a1665c33b011585a2a629fdbed5b61';

  thisTag.parentNode.insertBefore(script, thisTag);

  setTimeout(function () {
    script.parentNode.removeChild(script);
    thisTag.parentNode.removeChild(thisTag);
  }, 100);
})();</script><!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]--><script>__start__ = window.performance && performance.timing ? performance.timing.navigationStart : Date.now();</script></head><body><header id="header" hoot="default" hoot-rate="1" class="inner"><div class="f-left"><a href="/" class="site-title">bubkoo</a></div><nav class="f-right"><ul class="site-nav"><li><a href="/">&lt;&gt;</a></li><li><a href="/archives">Archives</a></li><li><a href="https://github.com/bubkoo">Github</a></li></ul></nav></header><div id="container" class="inner"><div id="main"><article class="article post"><div class="article-wrap"><header class="article-header"><span class="article-header-icon icon-black"></span><h1 class="article-header-title">MongoDB 用户和身份验证</h1><time datetime="2014-02-07T06:21:42.000Z" itemprop="datePublished" class="article-header-time"><span class="day">07</span><span class="month">2014年02月</span></time></header><section class="article-content"><p><a href="http://www.mongodb.org/" target="_blank" rel="external">MongoDB</a>是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。这里推荐一个快速入门教程 - <a href="http://www.cnblogs.com/huangxincheng/category/355399.html" target="_blank" rel="external">8天学通 MongoDB</a>，写的很全面。这里讨论的是 MongoDB 的用户和身份验证。</p>
<p>在默认情况下，MongoDB 不会进行身份验证，也没有账号，只要能连接上服务就可以对数据库进行各种操作，如果你在一个面向公众的服务器上使用它，那么这的确是一个问题。</p>
<p><img src="http://bubkoo.qiniudn.com/logo-mongodb-tagline.png" alt="http://blog.mongodb.org/"><br><a id="more"></a></p>
<p>作为数据库软件，我们肯定不想谁都可以访问，为了确保数据的安全，MongoDB 也会像其他的数据库软件一样可以采用用户验证的方法，那么该怎么做呢？其实很简单，MongoDB 提供了 addUser 方法，该方法包含三个参数：</p>
<ul>
<li>user - 字符串，表示用户名</li>
<li>password - 字符串，对应的密码</li>
<li>readOnly - boolean，可选参数，默认值为 <code>false</code>，表示是否是只读用户</li>
</ul>
<p>添加用户：<code>db.addUser(&quot;guest&quot;, &quot;pass&quot;, true)</code></p>
<p>修改用户密码： <code>db.addUser(&quot;guest&quot;, &quot;newpass&quot;)</code></p>
<p>删除用户： <code>db.removeUser(&quot;guest&quot;)</code></p>
<p>更复杂的使用方式请参考<a href="http://docs.mongodb.org/manual/reference/method/db.addUser/" target="_blank" rel="external">官方文档</a>。</p>
<p>可以将 MongoDB 的用户分为两类：超级用户和数据库用户。超级用户拥有最大权限，可以对所有数据库进行任意操作，超级用户储存在 admin 数据库中，刚安装的 MongoDB 中 admin 数据库是空的；数据库用户存储在单个数据库中，只能访问对应的数据库。另外，用户信息保存在 db.system.users 中。</p>
<p>关于用户和权限有以下特性：</p>
<ol>
<li>数据库是由超级用户来创建的，一个数据库可以包含多个用户，一个用户只能在一个数据库下，不同数据库中的用户可以同名</li>
<li>如果在 admin 数据库中不存在用户，即使 mongod 启动时添加了 –auth 参数，此时不进行任何认证还是可以做任何操作</li>
<li>在 admin 数据库创建的用户具有超级权限，可以对 MongoDB 系统内的任何数据库的数据对象进行操作</li>
<li>特定数据库比如 test1 下的用户 test_user1，不能够访问其他数据库 test2，但是可以访问本数据库下其他用户创建的数据</li>
<li>不同数据库中同名的用户不能够登录其他数据库。比如数据库 test1 和 test2 都有用户 test_user，以 test_user 登录 test1 后,不能够登录到 test2 进行数据库操作</li>
</ol>
<h2 id="实验验证"><a href="#实验验证" class="headerlink" title="实验验证"></a>实验验证</h2><p>开始之前，说明以下我的文件目录结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">─mongodb<span class="number">-2.4</span><span class="number">.8</span></div><div class="line">  ├─bin   <span class="comment">// MongoDB 的二进制文件</span></div><div class="line">  ├─data  <span class="comment">// MongoDB 数据库存放目录</span></div><div class="line">  └─log   <span class="comment">// MongoDB 日志存放目录</span></div></pre></td></tr></table></figure>
<p>首次安装 MongoDB 后，admin 数据库中没有用户，此时不管是否以 –auth 方式启动数据库，其他数据库(比如 test1 数据库)中的用户都可以对另外的数据库(比如 test2 数据库)中的数据进行操作。</p>
<p>以普通的方式启动 MongoDB</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8&gt;.\<span class="title">bin</span>\<span class="title">mongod</span> --<span class="title">dbpath</span>=.\<span class="title">data</span> --<span class="title">logpath</span>=.\<span class="title">log</span>\<span class="title">log.log</span></span></div></pre></td></tr></table></figure>
<p>打开另一个命令提示符窗口，进入 MongoDB Shell，默认直接连接 test 数据库，并且此时用户拥有超级权限，可以操作任何数据库对象。</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: <span class="title">test</span></div><div class="line"><span class="title">Welcome</span> <span class="title">to</span> <span class="title">the</span> <span class="title">MongoDB</span> <span class="title">shell</span>.</div><div class="line"><span class="title">For</span> <span class="title">interactive</span> <span class="title">help</span>, <span class="title">type</span> "<span class="title">help</span>".</div><div class="line"><span class="title">For</span> <span class="title">more</span> <span class="title">comprehensive</span> <span class="title">documentation</span>, <span class="title">see</span></div><div class="line">        <span class="title">http</span>://<span class="title">docs.mongodb.org</span>/</div><div class="line"><span class="title">Questions</span>? <span class="title">Try</span> <span class="title">the</span> <span class="title">support</span> <span class="title">group</span></div><div class="line">        <span class="title">http</span>://<span class="title">groups.google.com</span>/<span class="title">group</span>/<span class="title">mongodb</span>-<span class="title">user</span></div></pre></td></tr></table></figure>
<p>显示所有数据库，默认只有 local 数据库。</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; show dbs</div><div class="line">local   <span class="number">0</span>.<span class="number">078125</span>GB</div></pre></td></tr></table></figure>
<p>查看 admin 数据库中的用户信息，因为是刚建立的数据库所以 user 为空</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; use admin</div><div class="line">switched to db admin</div><div class="line">&gt; db.system.users.<span class="built_in">find</span>(); # 默认 admin 数据库中不存在用户</div></pre></td></tr></table></figure>
<p>操作 test 数据库，插入测试数据，并创建用户 test_user，密码为 password</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&gt; use test</div><div class="line">switched to db test</div><div class="line">&gt; db.system.users.<span class="built_in">find</span>(); # 默认 test 数据库中也不存在用户</div><div class="line">&gt; db.test_data.insert(&#123;"id":<span class="number">1</span>,"info":"I am <span class="keyword">in</span> test"&#125;)</div><div class="line">&gt; db.test_data.insert(&#123;"id":<span class="number">2</span>,"info":"I am <span class="keyword">in</span> test"&#125;)</div><div class="line">&gt; db.test_data.insert(&#123;"id":<span class="number">3</span>,"info":"I am <span class="keyword">in</span> test"&#125;)</div><div class="line"></div><div class="line">&gt; db.test_data.<span class="built_in">find</span>()</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5922125d9e18cd51581b6"), "id" : <span class="number">1</span>, "info" : "I am <span class="keyword">in</span> test" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5926d25d9e18cd51581b7"), "id" : <span class="number">2</span>, "info" : "I am <span class="keyword">in</span> test" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5927125d9e18cd51581b8"), "id" : <span class="number">3</span>, "info" : "I am <span class="keyword">in</span> test" &#125;</div><div class="line"></div><div class="line"># 创建用户</div><div class="line">&gt; db.addUser("test_user","password")</div><div class="line">&#123;</div><div class="line">        "user" : "test_user",</div><div class="line">        "readOnly" : false,</div><div class="line">        "pwd" : "bf7a0adf9822a3379d6dfb1ebd38b92e",</div><div class="line">        "_id" : ObjectId("<span class="number">52</span>f5928625d9e18cd51581b9")</div><div class="line">&#125;</div><div class="line">&gt; db.system.users.<span class="built_in">find</span>()</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5928625d9e18cd51581b9"), "user" : "test_user", "readOnly" : false, </div><div class="line">pwd" : "bf7a0adf9822a3379d6dfb1ebd38b92e" &#125;</div><div class="line"></div><div class="line"># 验证函数，验证数据库中是否存在对应的用户</div><div class="line">&gt; db.auth("test_user","password")</div><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure>
<p>创建 test1 数据库，并创建对象 test1_data，插入数据：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; use test1</div><div class="line">switched to db test1</div><div class="line">&gt; db.test1_data.insert(&#123;"id":<span class="number">1</span>,"info":"I am <span class="keyword">in</span> test1"&#125;)</div><div class="line">&gt; db.test1_data.insert(&#123;"id":<span class="number">2</span>,"info":"I am <span class="keyword">in</span> test1"&#125;)</div><div class="line">&gt; db.test1_data.insert(&#123;"id":<span class="number">3</span>,"info":"I am <span class="keyword">in</span> test1"&#125;)</div><div class="line">&gt; db.test1_data.<span class="built_in">find</span>()</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f593e925d9e18cd51581ba"), "id" : <span class="number">1</span>, "info" : "I am <span class="keyword">in</span> test1" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f593ef25d9e18cd51581bb"), "id" : <span class="number">2</span>, "info" : "I am <span class="keyword">in</span> test1" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f593f425d9e18cd51581bc"), "id" : <span class="number">3</span>, "info" : "I am <span class="keyword">in</span> test1" &#125;</div></pre></td></tr></table></figure>
<p>创建 test2 数据库，并创建对象 test2_data，插入数据：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; use test2</div><div class="line">switched to db test2</div><div class="line">&gt; db.test2_data.insert(&#123;"id":<span class="number">1</span>,"info":"I am <span class="keyword">in</span> test2"&#125;)</div><div class="line">&gt; db.test2_data.insert(&#123;"id":<span class="number">2</span>,"info":"I am <span class="keyword">in</span> test2"&#125;)</div><div class="line">&gt; db.test2_data.insert(&#123;"id":<span class="number">3</span>,"info":"I am <span class="keyword">in</span> test2"&#125;)</div><div class="line">&gt; db.test2_data.<span class="built_in">find</span>()</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5947725d9e18cd51581bd"), "id" : <span class="number">1</span>, "info" : "I am <span class="keyword">in</span> test2" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5947c25d9e18cd51581be"), "id" : <span class="number">2</span>, "info" : "I am <span class="keyword">in</span> test2" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5948125d9e18cd51581bf"), "id" : <span class="number">3</span>, "info" : "I am <span class="keyword">in</span> test2" &#125;</div></pre></td></tr></table></figure>
<p><strong>重新以认证的方式启动数据库</strong>，启动时添加 –auth 参数：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8&gt;.\<span class="title">bin</span>\<span class="title">mongod</span> --<span class="title">dbpath</span>=.\<span class="title">data</span> --<span class="title">logpath</span>=.\<span class="title">log</span>\<span class="title">log.log</span> --<span class="title">auth</span></span></div></pre></td></tr></table></figure>
<p>再次登录，虽然在 test 中创建了用户，但是<strong>没有在 admin 数据库中创建用户</strong>，所以以默认方式登录的用户依然具有超级权限</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: <span class="title">test</span></div></pre></td></tr></table></figure>
<p>默认具有超级权限，可以进行所有操作</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&gt; show dbs</div><div class="line">admin   (empty)</div><div class="line">local   <span class="number">0</span>.<span class="number">078125</span>GB</div><div class="line">test    <span class="number">0</span>.<span class="number">203125</span>GB</div><div class="line">test1   <span class="number">0</span>.<span class="number">203125</span>GB</div><div class="line">test2   <span class="number">0</span>.<span class="number">203125</span>GB</div><div class="line"></div><div class="line">&gt; use test</div><div class="line">switched to db test</div><div class="line">&gt; db.system.users.<span class="built_in">find</span>()</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5928625d9e18cd51581b9"), "user" : "test_user", "readOnly"</div><div class="line"> : false, "pwd" : "bf7a0adf9822a3379d6dfb1ebd38b92e" &#125;</div><div class="line"></div><div class="line">&gt; use test1</div><div class="line">switched to db test1</div><div class="line">&gt; db.test1_data.<span class="built_in">find</span>()</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f593e925d9e18cd51581ba"), "id" : <span class="number">1</span>, "info" : "I am <span class="keyword">in</span> test1" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f593ef25d9e18cd51581bb"), "id" : <span class="number">2</span>, "info" : "I am <span class="keyword">in</span> test1" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f593f425d9e18cd51581bc"), "id" : <span class="number">3</span>, "info" : "I am <span class="keyword">in</span> test1" &#125;</div><div class="line"></div><div class="line"># 插入数据</div><div class="line">&gt; db.test1_data.insert(&#123;"id":<span class="number">4</span>,"info":"I am <span class="keyword">in</span> test1"&#125;)</div><div class="line">&gt; db.test1_data.<span class="built_in">find</span>()</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f593e925d9e18cd51581ba"), "id" : <span class="number">1</span>, "info" : "I am <span class="keyword">in</span> test1" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f593ef25d9e18cd51581bb"), "id" : <span class="number">2</span>, "info" : "I am <span class="keyword">in</span> test1" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f593f425d9e18cd51581bc"), "id" : <span class="number">3</span>, "info" : "I am <span class="keyword">in</span> test1" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5ae44bee8a41e4b495370"), "id" : <span class="number">4</span>, "info" : "I am <span class="keyword">in</span> test1" &#125;</div><div class="line"></div><div class="line"># 创建数据库 test3，并插入数据</div><div class="line">&gt; use test3</div><div class="line">switched to db test3</div><div class="line">&gt; db.test3_data.insert(&#123;"id":<span class="number">1</span>,"info":"I am <span class="keyword">in</span> test3"&#125;)</div><div class="line">&gt; db.test3_data.insert(&#123;"id":<span class="number">2</span>,"info":"I am <span class="keyword">in</span> test3"&#125;)</div><div class="line">&gt; db.test3_data.insert(&#123;"id":<span class="number">3</span>,"info":"I am <span class="keyword">in</span> test3"&#125;)</div><div class="line">&gt; db.test3_data.<span class="built_in">find</span>()</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5aee9bee8a41e4b495371"), "id" : <span class="number">1</span>, "info" : "I am <span class="keyword">in</span> test3" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5af28bee8a41e4b495372"), "id" : <span class="number">2</span>, "info" : "I am <span class="keyword">in</span> test3" &#125;</div><div class="line">&#123; "_id" : ObjectId("<span class="number">52</span>f5af2cbee8a41e4b495373"), "id" : <span class="number">3</span>, "info" : "I am <span class="keyword">in</span> test3" &#125;</div></pre></td></tr></table></figure>
<p><strong>使用特定用户登录数据库，也可以访问其他的数据库</strong>。下面的例子中，使用 test 数据库中的用户 test_user 登录，但是由于 admin 数据库中不存在用户，所以任然具有超级权限。</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span> -<span class="title">utest_user</span> -<span class="title">ppassword</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: <span class="title">test</span></div><div class="line">&gt; <span class="title">show</span> <span class="title">dbs</span></div><div class="line"><span class="title">admin</span>   (<span class="title">empty</span>)</div><div class="line"><span class="title">local</span>   0.078125<span class="title">GB</span></div><div class="line"><span class="title">test</span>    0.203125<span class="title">GB</span></div><div class="line"><span class="title">test1</span>   0.203125<span class="title">GB</span></div><div class="line"><span class="title">test2</span>   0.203125<span class="title">GB</span></div><div class="line"><span class="title">test3</span>   0.203125<span class="title">GB</span></div><div class="line">&gt; <span class="title">use</span> <span class="title">test</span></div><div class="line"><span class="title">switched</span> <span class="title">to</span> <span class="title">db</span> <span class="title">test</span></div><div class="line">&gt; <span class="title">db.test_data.find</span>()</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5922125d9e18cd51581b6</span>"), "<span class="title">id</span>" : 1, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5926d25d9e18cd51581b7</span>"), "<span class="title">id</span>" : 2, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5927125d9e18cd51581b8</span>"), "<span class="title">id</span>" : 3, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&gt; <span class="title">use</span> <span class="title">test4</span></div><div class="line"><span class="title">switched</span> <span class="title">to</span> <span class="title">db</span> <span class="title">test4</span></div><div class="line">&gt; <span class="title">db.test4_data.insert</span>(&#123;"<span class="title">id</span>":1,"<span class="title">info</span>":"<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test4</span>"&#125;)</div><div class="line">&gt; <span class="title">db.test4_data.insert</span>(&#123;"<span class="title">id</span>":2,"<span class="title">info</span>":"<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test4</span>"&#125;)</div><div class="line">&gt; <span class="title">db.test4_data.insert</span>(&#123;"<span class="title">id</span>":3,"<span class="title">info</span>":"<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test4</span>"&#125;)</div><div class="line">&gt; <span class="title">db.test4_data.find</span>()</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5bce439a90d49d27742d2</span>"), "<span class="title">id</span>" : 1, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test4</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5bce839a90d49d27742d3</span>"), "<span class="title">id</span>" : 2, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test4</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5bcec39a90d49d27742d4</span>"), "<span class="title">id</span>" : 3, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test4</span>" &#125;</div></pre></td></tr></table></figure>
<p><strong>在 admin.system.users 中添加用户，使 MongoDB 的认证授权服务生效</strong></p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># 在 admin 数据库中创建用户 supper，密码为 password</div><div class="line">&gt; use admin</div><div class="line">switched to db admin</div><div class="line">&gt; db.addUser("supper","password")</div><div class="line">&#123;</div><div class="line">        "user" : "supper",</div><div class="line">        "readOnly" : false,</div><div class="line">        "pwd" : "<span class="number">0</span>d345bf64f4c1e8bc3e3bbb04c46b4d3",</div><div class="line">        "_id" : ObjectId("<span class="number">52</span>f5bdf439a90d49d27742d5")</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 认证</div><div class="line">&gt; db.auth("supper","password")</div><div class="line"><span class="number">1</span></div><div class="line">&gt;</div></pre></td></tr></table></figure>
<p>以默认方式登录，即以无认证用户登录，查询的时候会显示无权限：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: <span class="title">test</span></div><div class="line">&gt; <span class="title">db.system.users.find</span>()</div><div class="line"><span class="title">error</span>: &#123; "$<span class="title">err</span>" : "<span class="title">not</span> <span class="title">authorized</span> <span class="title">for</span> <span class="title">query</span> <span class="title">on</span> <span class="title">test.system.users</span>", "<span class="title">code</span>" : 16550 &#125;</div><div class="line">&gt; <span class="title">show</span> <span class="title">dbs</span></div><div class="line"><span class="title">Sat</span> <span class="title">Feb</span> 08 13:20:27.831 <span class="title">listDatabases</span> <span class="title">failed</span>:&#123; "<span class="title">ok</span>" : 0, "<span class="title">errmsg</span>" : "<span class="title">unauthorized</span>" &#125; <span class="title">at</span> <span class="title">src</span>/<span class="title">mongo</span>/<span class="title">shell</span>/<span class="title">mongo.js</span>:46</div></pre></td></tr></table></figure>
<p>在 admin 数据库创建用户后，使用认证方式登录，可进行对应数据库的查询操作且仅仅能够查询对应的数据库中的信息，不能够查询其他 MongoDB 系统的其他数据库信息：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"># 使用 test 数据库中的用户可以查询 test 的数据，但是不能查看其他的数据库的数据</div><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span> -<span class="title">utest_user</span> -<span class="title">ppassword</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: <span class="title">test</span></div><div class="line">&gt; <span class="title">db.system.users.find</span>()</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5928625d9e18cd51581b9</span>"), "<span class="title">user</span>" : "<span class="title">test_user</span>", "<span class="title">readOnly</span>"</div><div class="line"> : <span class="title">false</span>, "<span class="title">pwd</span>" : "<span class="title">bf7a0adf9822a3379d6dfb1ebd38b92e</span>" &#125;</div><div class="line">&gt; <span class="title">db.test_data.find</span>()</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5922125d9e18cd51581b6</span>"), "<span class="title">id</span>" : 1, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5926d25d9e18cd51581b7</span>"), "<span class="title">id</span>" : 2, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5927125d9e18cd51581b8</span>"), "<span class="title">id</span>" : 3, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line"></div><div class="line"># 查询系统数据库信息，报错</div><div class="line">&gt; <span class="title">show</span> <span class="title">dbs</span></div><div class="line"><span class="title">Sat</span> <span class="title">Feb</span> 08 13:23:03.423 <span class="title">listDatabases</span> <span class="title">failed</span>:&#123; "<span class="title">ok</span>" : 0, "<span class="title">errmsg</span>" : "<span class="title">unauthorized</span>" &#125; <span class="title">at</span> <span class="title">src</span>/<span class="title">mongo</span>/<span class="title">shell</span>/<span class="title">mongo.js</span>:46</div><div class="line"></div><div class="line"># 查询 <span class="title">test1</span> 数据库，报错</div><div class="line">&gt; <span class="title">use</span> <span class="title">test1</span></div><div class="line"><span class="title">switched</span> <span class="title">to</span> <span class="title">db</span> <span class="title">test1</span></div><div class="line">&gt; <span class="title">db.test1_data.find</span>()</div><div class="line"><span class="title">error</span>: &#123; "$<span class="title">err</span>" : "<span class="title">not</span> <span class="title">authorized</span> <span class="title">for</span> <span class="title">query</span> <span class="title">on</span> <span class="title">test1.test1_data</span>", "<span class="title">code</span>" : 16550 &#125;</div><div class="line"></div><div class="line"># 查询 <span class="title">test2</span> 数据库，报错</div><div class="line">&gt; <span class="title">use</span> <span class="title">test2</span></div><div class="line"><span class="title">switched</span> <span class="title">to</span> <span class="title">db</span> <span class="title">test2</span></div><div class="line">&gt; <span class="title">db.test2_data.find</span>()</div><div class="line"><span class="title">error</span>: &#123; "$<span class="title">err</span>" : "<span class="title">not</span> <span class="title">authorized</span> <span class="title">for</span> <span class="title">query</span> <span class="title">on</span> <span class="title">test2.test2_data</span>", "<span class="title">code</span>" : 16550 &#125;</div></pre></td></tr></table></figure>
<p>使用 supper 用户登录，可以对 MongoDB 系统内的所有数据库进行操作：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span> 127.0.0.1/<span class="title">admin</span> -<span class="title">usupper</span> -<span class="title">ppassword</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: 127.0.0.1/<span class="title">admin</span></div><div class="line"></div><div class="line">&gt; <span class="title">show</span> <span class="title">dbs</span></div><div class="line"><span class="title">admin</span>   0.203125<span class="title">GB</span></div><div class="line"><span class="title">local</span>   0.078125<span class="title">GB</span></div><div class="line"><span class="title">test</span>    0.203125<span class="title">GB</span></div><div class="line"><span class="title">test1</span>   0.203125<span class="title">GB</span></div><div class="line"><span class="title">test2</span>   0.203125<span class="title">GB</span></div><div class="line"><span class="title">test3</span>   0.203125<span class="title">GB</span></div><div class="line"><span class="title">test4</span>   0.203125<span class="title">GB</span></div><div class="line"></div><div class="line">&gt; <span class="title">use</span> <span class="title">test</span></div><div class="line"><span class="title">switched</span> <span class="title">to</span> <span class="title">db</span> <span class="title">test</span></div><div class="line">&gt; <span class="title">db.addUser</span>("<span class="title">test_user1</span>","<span class="title">password</span>")</div><div class="line">&#123;</div><div class="line">        "<span class="title">user</span>" : "<span class="title">test_user1</span>",</div><div class="line">        "<span class="title">readOnly</span>" : <span class="title">false</span>,</div><div class="line">        "<span class="title">pwd</span>" : "<span class="title">af20fbd43eb73735b7fc7271f0d18ce4</span>",</div><div class="line">        "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5c0c01caaf8492f79da16</span>")</div><div class="line">&#125;</div><div class="line">&gt; <span class="title">db.test_data.find</span>()</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5922125d9e18cd51581b6</span>"), "<span class="title">id</span>" : 1, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5926d25d9e18cd51581b7</span>"), "<span class="title">id</span>" : 2, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5927125d9e18cd51581b8</span>"), "<span class="title">id</span>" : 3, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&gt; <span class="title">db.test_data.insert</span>(&#123;"<span class="title">id</span>":4,"<span class="title">info</span>":"<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>"&#125;)</div><div class="line">&gt; <span class="title">db.test_data.find</span>()</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5922125d9e18cd51581b6</span>"), "<span class="title">id</span>" : 1, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5926d25d9e18cd51581b7</span>"), "<span class="title">id</span>" : 2, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5927125d9e18cd51581b8</span>"), "<span class="title">id</span>" : 3, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5c10e1caaf8492f79da17</span>"), "<span class="title">id</span>" : 4, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div></pre></td></tr></table></figure>
<p>特定数据库比如 test 下的用户 test_user，是可以访问本数据库下其他用户创建的数据：</p>
<p>用 test_user1 登录 test 数据库，并插入数据</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span> 127.0.0.1/<span class="title">test</span> -<span class="title">utest_user1</span> -<span class="title">ppassword</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: 127.0.0.1/<span class="title">test</span></div><div class="line">&gt; <span class="title">db.test_data.insert</span>(&#123;"<span class="title">id</span>":5,"<span class="title">info</span>":"<span class="title">I</span> <span class="title">am</span> <span class="title">created</span> <span class="title">by</span> <span class="title">test_user1</span>"&#125;)</div><div class="line">&gt; <span class="title">db.test_data.insert</span>(&#123;"<span class="title">id</span>":6,"<span class="title">info</span>":"<span class="title">I</span> <span class="title">am</span> <span class="title">created</span> <span class="title">by</span> <span class="title">test_user1</span>"&#125;)</div><div class="line">&gt; <span class="title">db.test_data.find</span>()</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5922125d9e18cd51581b6</span>"), "<span class="title">id</span>" : 1, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5926d25d9e18cd51581b7</span>"), "<span class="title">id</span>" : 2, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5927125d9e18cd51581b8</span>"), "<span class="title">id</span>" : 3, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5c10e1caaf8492f79da17</span>"), "<span class="title">id</span>" : 4, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5c1eb15944f80880dfb1f</span>"), "<span class="title">id</span>" : 5, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">created</span> <span class="title">by</span> <span class="title">test_user1</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5c1f015944f80880dfb20</span>"), "<span class="title">id</span>" : 6, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">created</span> <span class="title">by</span> <span class="title">test_user1</span>" &#125;</div></pre></td></tr></table></figure>
<p>用 test_user 重新登录 test 数据库，可以查询到 test_user1 创建的数据：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span> 127.0.0.1/<span class="title">test</span> -<span class="title">utest_user</span> -<span class="title">ppassword</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: 127.0.0.1/<span class="title">test</span></div><div class="line">&gt; <span class="title">db.test_data.find</span>()</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5922125d9e18cd51581b6</span>"), "<span class="title">id</span>" : 1, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5926d25d9e18cd51581b7</span>"), "<span class="title">id</span>" : 2, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5927125d9e18cd51581b8</span>"), "<span class="title">id</span>" : 3, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5c10e1caaf8492f79da17</span>"), "<span class="title">id</span>" : 4, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">in</span> <span class="title">test</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5c1eb15944f80880dfb1f</span>"), "<span class="title">id</span>" : 5, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">created</span> <span class="title">by</span> <span class="title">test_user1</span>" &#125;</div><div class="line">&#123; "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5c1f015944f80880dfb20</span>"), "<span class="title">id</span>" : 6, "<span class="title">info</span>" : "<span class="title">I</span> <span class="title">am</span> <span class="title">created</span> <span class="title">by</span> <span class="title">test_user1</span>" &#125;</div></pre></td></tr></table></figure>
<p>不同数据库中的用户可以同名，不同数据库中同名的用户不能登录其他数据库。例如 test1 和 test2 中都有 some_user，以 some_user 登录 test1 后，不能够登录到 test2 进行数据库操作</p>
<p>首先，在  test1 和 test2 中创建同名用户 some_user，密码都为 password：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"># 创建用户需要超级权限，用 supper 用户登录 admin 数据库</div><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span> 127.0.0.1/<span class="title">admin</span> -<span class="title">usupper</span> -<span class="title">ppassword</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: 127.0.0.1/<span class="title">admin</span></div><div class="line"></div><div class="line">&gt; <span class="title">use</span> <span class="title">test1</span></div><div class="line"><span class="title">switched</span> <span class="title">to</span> <span class="title">db</span> <span class="title">test1</span></div><div class="line">&gt; <span class="title">db.addUser</span>("<span class="title">some_user</span>","<span class="title">password</span>")</div><div class="line">&#123;</div><div class="line">        "<span class="title">user</span>" : "<span class="title">some_user</span>",</div><div class="line">        "<span class="title">readOnly</span>" : <span class="title">false</span>,</div><div class="line">        "<span class="title">pwd</span>" : "<span class="title">ed235c1f49990c04775a33e58ede9f99</span>",</div><div class="line">        "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5c385daeb9d6bbdf0a741</span>")</div><div class="line">&#125;</div><div class="line"></div><div class="line">&gt; <span class="title">use</span> <span class="title">test2</span></div><div class="line"><span class="title">switched</span> <span class="title">to</span> <span class="title">db</span> <span class="title">test2</span></div><div class="line">&gt; <span class="title">db.addUser</span>("<span class="title">some_user</span>","<span class="title">password</span>")</div><div class="line">&#123;</div><div class="line">        "<span class="title">user</span>" : "<span class="title">some_user</span>",</div><div class="line">        "<span class="title">readOnly</span>" : <span class="title">false</span>,</div><div class="line">        "<span class="title">pwd</span>" : "<span class="title">ed235c1f49990c04775a33e58ede9f99</span>",</div><div class="line">        "<span class="title">_id</span>" : <span class="title">ObjectId</span>("52<span class="title">f5c3a1daeb9d6bbdf0a742</span>")</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后，以 some_user 登录 test1，并尝试对 test2 进行操作：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span> 127.0.0.1/<span class="title">test1</span> -<span class="title">usome_user</span> -<span class="title">ppassword</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: 127.0.0.1/<span class="title">test1</span></div><div class="line"></div><div class="line"># 查询数据库 <span class="title">test2</span>，出错</div><div class="line">&gt; <span class="title">use</span> <span class="title">test2</span></div><div class="line"><span class="title">switched</span> <span class="title">to</span> <span class="title">db</span> <span class="title">test2</span></div><div class="line">&gt; <span class="title">db.test2_data.find</span>()</div><div class="line"><span class="title">error</span>: &#123; "$<span class="title">err</span>" : "<span class="title">not</span> <span class="title">authorized</span> <span class="title">for</span> <span class="title">query</span> <span class="title">on</span> <span class="title">test2.test2_data</span>", "<span class="title">code</span>" : 16550 &#125;</div></pre></td></tr></table></figure>
<p>使用 db.auth() 可以对数据库中的用户进行验证，如果验证成功则返回 1，否则返回 0。db.auth() 只能针对登录用户所属的数据库的用户信息进行验证，不能验证其他数据库的用户信息。</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function">D:\<span class="title">MongoDB</span>\<span class="title">mongodb</span>-2.4.8\<span class="title">bin</span>&gt;<span class="title">mongo</span> 127.0.0.1/<span class="title">test</span> -<span class="title">utest_user</span> -<span class="title">ppassword</span></span></div><div class="line"><span class="title">MongoDB</span> <span class="title">shell</span> <span class="title">version</span>: 2.4.8</div><div class="line"><span class="title">connecting</span> <span class="title">to</span>: 127.0.0.1/<span class="title">test</span></div><div class="line">&gt; <span class="title">db.auth</span>("<span class="title">test_user1</span>","<span class="title">password</span>")</div><div class="line">1</div><div class="line">&gt; <span class="title">db.auth</span>("<span class="title">some_user</span>","<span class="title">password</span>")</div><div class="line"><span class="title">Error</span>: 18 &#123; <span class="title">code</span>: 18, <span class="title">ok</span>: 0.0, <span class="title">errmsg</span>: "<span class="title">auth</span> <span class="title">fails</span>" &#125;</div><div class="line">0</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>启用 MongoDB 用户认证的步骤：</p>
<ol>
<li>在要启用认证的数据库中创建对应的用户</li>
<li>如果 admin 中没有用户，则必须在 admin 中添加用户，否则即使使用 –auth 的方式启动 MongoDB，认证方式也无效，默认会拥有超级权限</li>
<li>以认证方式，即 –auth 参数的方式启动 MongoDB 数据库</li>
<li>用数据库对应的用户登录数据库，比如：mongo 127.0.0.1/test -utest_user -ppasword</li>
</ol></section><footer class="article-footer clearfix"><div class="tags"><a href="/tags/mongodb/" title="MongoDB">MongoDB</a></div></footer></div><nav class="article-nav clearfix"><a href="/2014/02/13/writing-fast-memory-efficient-javascript/" class="article-nav-link article-nav-newer"><strong class="article-nav-type">Newer</strong><span class="article-nav-title">【译】编写快速、高效的 JavaScript</span></a><a href="/2014/01/23/deep-in-delete/" class="article-nav-link article-nav-older"><strong class="article-nav-type">Older</strong><span class="article-nav-title">深入理解 JavaScript 中的 delete 操作符</span></a></nav></article><section id="article-comment" class="article-comment"><div data-thread-key="http://bubkoo.com/2014/02/07/mongodb-authentication/" data-title="MongoDB 用户和身份验证" data-url="http://bubkoo.com/2014/02/07/mongodb-authentication/" class="ds-thread"></div></section></div><aside id="sidebar" role="sidebar"><div class="widget tagcloud"><h3 class="widget-title">标签</h3><div class="widget-content"><a href="/tags/aop/" style="font-size: 10px">AOP</a> <a href="/tags/algorithm/" style="font-size: 18.33px">Algorithm</a> <a href="/tags/analysis/" style="font-size: 10px">Analysis</a> <a href="/tags/angularjs/" style="font-size: 15px">AngularJS</a> <a href="/tags/animation/" style="font-size: 10px">Animation</a> <a href="/tags/architecture/" style="font-size: 16.67px">Architecture</a> <a href="/tags/archives/" style="font-size: 10.83px">Archives</a> <a href="/tags/async/" style="font-size: 12.5px">Async</a> <a href="/tags/backbone/" style="font-size: 10px">Backbone</a> <a href="/tags/browsers/" style="font-size: 10px">Browsers</a> <a href="/tags/css/" style="font-size: 12.5px">CSS</a> <a href="/tags/css3/" style="font-size: 10px">CSS3</a> <a href="/tags/closure/" style="font-size: 10.83px">Closure</a> <a href="/tags/closures/" style="font-size: 10px">Closures</a> <a href="/tags/cookies/" style="font-size: 10px">Cookies</a> <a href="/tags/cross-domain/" style="font-size: 10px">Cross Domain</a> <a href="/tags/custom-elements/" style="font-size: 10.83px">Custom Elements</a> <a href="/tags/d3/" style="font-size: 10px">D3</a> <a href="/tags/debounce/" style="font-size: 10px">Debounce</a> <a href="/tags/debug/" style="font-size: 10.83px">Debug</a> <a href="/tags/dependency/" style="font-size: 10px">Dependency</a> <a href="/tags/document/" style="font-size: 10px">Document</a> <a href="/tags/ecma-262-3/" style="font-size: 15.83px">ECMA-262-3</a> <a href="/tags/ecmascript/" style="font-size: 15.83px">ECMAScript</a> <a href="/tags/es6/" style="font-size: 20px">ES6</a> <a href="/tags/errors/" style="font-size: 10px">Errors</a> <a href="/tags/essential/" style="font-size: 10px">Essential</a> <a href="/tags/evaluation-strategy/" style="font-size: 10px">Evaluation strategy</a> <a href="/tags/event/" style="font-size: 10px">Event</a> <a href="/tags/exceptions/" style="font-size: 10px">Exceptions</a> <a href="/tags/express/" style="font-size: 10px">Express</a> <a href="/tags/flip/" style="font-size: 10px">FLIP</a> <a href="/tags/flexbox/" style="font-size: 10px">Flexbox</a> <a href="/tags/funarg/" style="font-size: 10px">Funarg</a> <a href="/tags/gist/" style="font-size: 10px">Gist</a> <a href="/tags/github/" style="font-size: 10px">Github</a> <a href="/tags/guide/" style="font-size: 10px">Guide</a> <a href="/tags/html/" style="font-size: 10px">HTML</a> <a href="/tags/http/" style="font-size: 10px">HTTP</a> <a href="/tags/hexo/" style="font-size: 10.83px">Hexo</a> <a href="/tags/ie/" style="font-size: 10px">IE</a> <a href="/tags/iife/" style="font-size: 10px">IIFE</a> <a href="/tags/jshint/" style="font-size: 10px">JSHint</a> <a href="/tags/javascript/" style="font-size: 19.17px">JavaScript</a> <a href="/tags/leak/" style="font-size: 10px">Leak</a> <a href="/tags/linting/" style="font-size: 10px">Linting</a> <a href="/tags/mvc/" style="font-size: 10px">MVC</a> <a href="/tags/methodology/" style="font-size: 10px">Methodology</a> <a href="/tags/mock/" style="font-size: 10px">Mock</a> <a href="/tags/modular/" style="font-size: 10px">Modular</a> <a href="/tags/mongodb/" style="font-size: 10px">MongoDB</a> <a href="/tags/oop/" style="font-size: 10.83px">OOP</a> <a href="/tags/partial-application/" style="font-size: 10px">Partial Application</a> <a href="/tags/pattern/" style="font-size: 10px">Pattern</a> <a href="/tags/patterns/" style="font-size: 10px">Patterns</a> <a href="/tags/performance/" style="font-size: 14.17px">Performance</a> <a href="/tags/promise/" style="font-size: 13.33px">Promise</a> <a href="/tags/prototype/" style="font-size: 11.67px">Prototype</a> <a href="/tags/quality/" style="font-size: 10px">Quality</a> <a href="/tags/quiz/" style="font-size: 10px">Quiz</a> <a href="/tags/regex/" style="font-size: 10px">Regex</a> <a href="/tags/requirejs/" style="font-size: 10px">RequireJS</a> <a href="/tags/sass/" style="font-size: 10px">SASS</a> <a href="/tags/svg/" style="font-size: 10px">SVG</a> <a href="/tags/scope/" style="font-size: 10.83px">Scope</a> <a href="/tags/shapes/" style="font-size: 10px">Shapes</a> <a href="/tags/shuffle/" style="font-size: 10px">Shuffle</a> <a href="/tags/sort/" style="font-size: 17.5px">Sort</a> <a href="/tags/source-map/" style="font-size: 10.83px">Source Map</a> <a href="/tags/styling/" style="font-size: 10px">Styling</a> <a href="/tags/sublime-text/" style="font-size: 10px">Sublime Text</a> <a href="/tags/template/" style="font-size: 10px">Template</a> <a href="/tags/throttle/" style="font-size: 10px">Throttle</a> <a href="/tags/timing/" style="font-size: 10px">Timing</a> <a href="/tags/tools/" style="font-size: 12.5px">Tools</a> <a href="/tags/variable-object/" style="font-size: 10px">Variable object</a> <a href="/tags/visualizations/" style="font-size: 10px">Visualizations</a> <a href="/tags/when/" style="font-size: 12.5px">When</a> <a href="/tags/delete/" style="font-size: 10px">delete</a> <a href="/tags/execution-context/" style="font-size: 10px">execution context</a> <a href="/tags/fetch/" style="font-size: 10px">fetch</a> <a href="/tags/function/" style="font-size: 10px">function</a> <a href="/tags/nodejs/" style="font-size: 10px">nodejs</a> <a href="/tags/nodemon/" style="font-size: 10px">nodemon</a> <a href="/tags/npm/" style="font-size: 10px">npm</a> <a href="/tags/nvm/" style="font-size: 10px">nvm</a> <a href="/tags/performance/" style="font-size: 10px">performance</a> <a href="/tags/prebrowsing/" style="font-size: 10px">prebrowsing</a> <a href="/tags/prefetching/" style="font-size: 10px">prefetching</a> <a href="/tags/preloading/" style="font-size: 10px">preloading</a> <a href="/tags/tabindex/" style="font-size: 10px">tabindex</a> <a href="/tags/this/" style="font-size: 10px">this</a> <a href="/tags/ui-router/" style="font-size: 14.17px">ui-router</a></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-content"><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/01/18/debouncing-throttling-explained-examples/">实例解析防抖和节流函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/08/quick-tip-multiple-versions-node-nvm/">使用 nvm 管理不同版本的 node 与 npm</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/15-ways-to-write-self-documenting-javascript/">如何编写更加自解释的代码</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/31/high-performance-animations/">使用 FLIP 来提高 Web 动画的性能</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/28/styling-broken-images/">定制图片加载失败时的样式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/26/delivering-octicons-with-svg/">使用 SVG 输出 Octicon</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/18/how-to-use-npm-as-a-build-tool/">如何将 npm 作为构建工具使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/24/what-you-can-do-with-gists-on-github/">任何人都可以使用到的 Gist 服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/19/prefetching-preloading-prebrowsing/">前端性能优化 - 资源预加载</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/18/es6-in-depth-the-future/">深入解析 ES6：未来展望</a></li></ul></div></div></aside><aside id="topic-wrap" class="toc-wrap f-right"><h3 class="toc-wrap-title">内容</h3><div class="toc-tree"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#实验验证"><span class="toc-number">1.</span> <span class="toc-text">实验验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">2.</span> <span class="toc-text">总结</span></a></li></ol></div><div class="toc-progress"></div></aside></div><footer id="footer" class="inner"><span class="copyright">© 2017 bubkoo</span><span class="theme">@<a href="https://github.com/bubkoo/hexo-theme-formula" target="_blank">formula</a></span></footer><img id="go2top" src="/images/top_arrow.png" alt="go2top"><script charset="utf-8" src="/js/lib/jquery-2.1.3.min.js"></script><script charset="utf-8" src="/js/lib/jquery.imagesloaded.min.js"></script><script charset="utf-8" src="/fancybox/jquery.fancybox.pack.js"></script><script charset="utf-8" src="/js/lib/sea.js"></script><script charset="utf-8" src="/js/main.js"></script><script id="redundancy3">var duoshuoQuery = { short_name: 'bubkoo' };
(function () {
  var ds = document.createElement('script');

  ds.type    = 'text/javascript';
  ds.async   = true;
  ds.src     = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';

  (document.getElementsByTagName('head')[0]
  || document.getElementsByTagName('body')[0]).appendChild(ds);

  ds.parentNode.removeChild(ds);

  var script = document.getElementById('redundancy3');
  script && script.parentNode.removeChild(script);
})();</script></body></html>